### 2.11.2. 降级MySQL

本节讲述在很不常见的旧版本比新版本工作的更好的情况下，如何降级到一个较老的MySQL版本。

事先做好备份总是一个好主意，以防止降级失败导致MySQL实例处于不可用状态。

要在同一个分发系列的一般可用（GA）状态的版本之间降级，通常可以直接在旧版本基础上安装新的二进制文件，而不需要对数据库做任何改动。

在同一发行系列的里程碑发行版之间降级（或者从GA发行版到里程碑发行版降级）是不支持的，因此可能会碰到问题。

下面的一览表中的清单在任何降级操作中都需要检查：

* 阅读手册中针对要降级的版本中的升级说明，以确保该版本不包含任何十分需要的功能。参见[2.11.1节，“升级MySQL”](./02.11.00_Upgrading_or_Downgrading_MySQL.md)。

* 如果该版本手册中带有降级部分，同样要阅读它。

* 要查看当前版本和要降级到的版本之间添加了哪些功能，参见[发行注记](http://dev.mysql.com/doc/relnotes/mysql/5.6/en/)。

* 查看[2.11.3节，“检查是否需要重建表或索引”](./02.11.03_Checking_Whether_Tables_or_Indexes_Must_Be_Rebuilt.md)，以鉴别在当前版本MySQL和要降级到的版本之间是否有表格式或字符集或比较规则的更改。如果有并且这些更改会导致版本间的不兼容，则需要根据[2.11.4节，“重建或修复表或索引”](./02.11.04_Rebuilding_or_Repairing_Tables_or_Indexes.md)中的说明来降级受影响的表。

多数情况下，只要保持使用同一发行系列的MySQL版本，在同一架构上可以在不同的GA版本间移动MySQL格式文件和数据文件。

如果从一个发行系列降级到另外一个，表存储格式可能会有不兼容。这时要使用 **mysqldump** 在降级之前转储数据。降级后，使用 **mysql** 或 **mysqlimport** 来载入转储文件来重新创建表。例如，参见[2.11.5，“将MySQL数据库拷贝到另外一台主机“](./02.11.05_Copying_MySQL_Databases_to_Another_Machine.md)。

向下不兼容表格式改变的一个典型表现是，在降级之后无法打开表。这时，采用下面的步骤：

1. 关闭降级到的旧版本MySQL服务器。

2. 重新启动降级前的新版本MySQL服务器。

3. 使用 **mysqldump** 将旧版本服务器无法使用的表转储到文件中。

4. 关闭新版本MySQL服务器并重新启动旧版本。

5. 将转储文件载入到旧版本服务器中。这些表现在应该可以访问。

如果 **mysql** 数据库中的系统表有更改，降级可能会导致一些功能的丢失或者需要一些调整。下面是一些例子：

* 从MySQL 5.1开始，创建触发器需要 **TRIGGER** 权限。在MySQL 5.0中没有 **TRIGGER** 权限因此需要 **SUPER** 权限。如果由MySQL 5.1降级至5.0，则需要给在5.1中拥有 **TRIGGER** 权限的账户赋予 **SUPER** 权限。

* 触发器在MySQL 5.0中添加，因此如果由5.0降级至4.1，将完全无法使用触发器。

* **mysql.proc.comment** 的列定义在5.1和5.5之间有更改。从5.5降级到5.1后，这个表会被视为无法使用并需要进行修复。作为一个变通办法，可以执行降级到的MySQL版本中的 **mysql_upgrade** 程序。

<a name="02.11.02.01"/>2.11.2.1 降级到MySQL 5.5

在由MySQL 5.6降级到5.5时，记住下面与只在MySQL 5.6中可用而不存在于5.5中功能相关的问题：

**系统表**

* MySQL 5.6中的 **mysql.user** 表有一个 **password_expired** 列。而MySQL 5.5中的 **mysql.user** 表没有。这意味着MySQL 5.6中密码过期的账户在MySQL 5.5中依然可以使用。

**InnoDB**

* MySQL 5.6.4中引入的 **InnoDB** 搜索索引（**FULLTEXT** 类型）在之前版本的MySQL中无法兼容，包括5.6系列中的较早发行版。在降级之前要移除这样的索引。

* MySQL 5.6.4中引入的指定 **InnoDB** 小页大小的 **innodb_page_size** 配置选项，在之前版本的MySQL中无法兼容，包括5.6系列中的较早发行版。需要将使用较小 **InnoDB** 页大小的表转储，删除这些表，并在降级之后重新创建和载入这些表。

**复制**

* 从MySQL 5.6开始，**relay-log.info** 文件含有一个行计数和复制延迟值，因此这个文件格式与之前版本不同。参见[16.2.2.2节，“从服务器状态日志”](../Chapter_16/16.02.02_Replication_Relay_and_Status_Logs.md#16.02.02.02)。如果将一个从服务器降级到MySQL 5.6之前的版本，旧版本的服务器将无法正确读入这个文件。要修正这个问题，使用文本编辑器修改这个文件来将含有行数的行删除。

* 从MySQL 5.6.6开始，MySQL服务器在书写二进制日志时使用版本2的二进制格式。旧版本的MySQL服务器无法识别使用版本2日志事项写的二进制日志。要生成旧版本服务器可以识别的使用版本1格式书写的二进制日志，在启动MySQL 5.6.6或更新版本时使用 **--log-bin-use-v1-row-events=1**，从而强制使服务器在书写二进制日志时使用版本1格式。