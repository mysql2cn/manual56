# 6.1.1 安全指南

### 6.1.1 安全指南
任何在与Internet联网的计算机上使用MySQL的用户都应仔细阅读本节，以避免最常见的安全问题。

讨论安全时，我们强调必须完全保护整个服务器主机的安全(而不只是MySQL服务器)防范各种类型的可能的攻击：偷听、修改、重放和拒绝服务。我们在这里不能覆盖各方面的内容和措施。

MySQL根据访问控制列表(ACL)对所有连接、查询和其它用户尝试执行的操作进行安全管理。MySQL客户端和服务器之间还支持SSL-加密连接。这儿讨论的许多概念并不是MySQL专有的；该思想几乎同样适合所有应用程序。

运行MySQL时，应尽量遵从下面的指导：

* **不要让任何人(除了MySQL root账户)访问mysql数据库中的user表！**这很关键。
* 学习MySQL访问权限系统(参见[6.2 MySQL访问权限系统][06.02.00])。用GRANT和REVOKE语句来控制对MySQL的访问。不要授予超过需求的权限。决不能为所有主机授权。

	检查清单：

	*  试试mysql -u root。如果你能够成功连接服务器而没有要任何密码，则说明有问题。任何人可以作为MySQLroot用户用它的全部权限来连接MySQL服务器！查阅MySQL安装说明，应特别注意关于设置root密码的信息。参见[2.10.2 安全初始化MySQL账户][02.10.02]。
	*  通过SHOW GRANTS语句检查查看谁已经访问了什么。然后使用REVOKE语句删除不再需要的权限。

* 不要将纯文本密码保存到数据库中。如果你的计算机有安全危险，入侵者可以获得所有的密码并使用它们。相反，应使用SHA1()、SHA2()、MD5()，或单向哈希函数。
* 不要从词典中选择密码。有专门的程序可以破解它们。即使象“xfish98”这样的密码也很差。而“duag98”要好得多，虽然包含了相同的字“fish”，但从标准QWERTY键盘向左输入。另一种方法是使用一个句子中的每个单词的首字母（例如，“Four
score and seven years ago” 产生一个密码 “Fsasya”）。这样很容易记住并输入，但是不知道的人很难猜出来。在这个例子中，你可以用数字来代替单词“4 score and 7 years ago”,产生一个密码“4sa7ya”，这更难被猜中。
* 购买防火墙。这样可以保护你防范各种软件中至少50%的各种类型的攻击。把MySQL放到防火墙后或隔离区(DMZ)。
	
	检查清单：
	* 试试从Internet使用nmap工具扫描端口。MySQL默认使用端口3306。不应从不可信任主机访问该端口。另一种检查是否MySQL端口打开的简单方式是从远程机器试试下面的命令，其中server_host是MySQL服务器运行的主机：
	
	    ```shell>
	telnet server_host 3306
	```
	
		如果telnet挂起或连接被拒绝，则端口被阻塞，这是你所希望的。如果得到连接并得到一些垃圾字符，则端口打开着，则应从防火墙或路由器上关闭，除非你有合理的理由让它开着。
	* 应用程序访问MySQL不应该相信任何用户输入的数据，并使用适当的防御性的编程技术。参见[6.1.7 客户端程序安全指南][06.01.07]。
	
	* 不要通过Internet传送明文(未加密的)数据。该信息可以被有足够时间和能力来截取它并用于个人目的的任何人访问。相反，应使用加密协议，例如SSL或SSH。MySQL支持内部SSL连接。另一个技术是使用SSH端口转发创建一个加密(压缩)隧道来通信。
	* 学会使用tcpdump和strings工具。在大多数情况下，你可以使用下面的命令检查是否MySQL数据流未加密：
			
		```shell>
		    tcpdump -l -i eth0 -w - src or dst port 3306 | strings
		```
	
		该命令在Linux中可以工作，在其它系统中经过小小的修改后应可以工作。
		
		**警告**
		
		如果你没有看见明文数据，并不一定说明信息实际上被加密了。如果你需要较高级别的安全，你应咨询安全专家。



[06.02.00]:06.02.00_The_MySQL_Access_Privilege_System.md
[02.10.02]:../Chapter_02/02.10.02_Securing_the_Initial_MySQL_Accounts.md
[06.01.07]:06.01.07_Client_Programming_Security_Guidelines.md