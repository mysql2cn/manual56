# 10.1.13. 列字符集转换

### 10.1.13. 列字符集转换

要转换二进制或使用特定的字符集的非二进制字符串列，使用 [ALTER TABLE]()。对于转换的成功，满足必须满足下列条件之一：

* 如果有一个十六进制数据类型列（[BINARY，VARBINARY]()，[BLOB]()），它包含的所有值必须被编码使用单字节字符集（你转换列的符集）。如果您使用的二进制列将信息存储在多个字符集，MySQL有没有办法知道哪些值使用的字符集，并不能正确的数据转换。
* 如果有一个十六进制数据类型列（[CHAR, VARCHAR]()，[TEXT]()），它的内容必须被列字符集锁编码，而不能别其他的字符集。如果内容被其他的字符集编码，你可以首先转换列成使用十六进制的数据类型，然后在转成所要的字符集非十六进制列。

假定一个表有一个名叫 `col1` 十六进制列定义成 `VARBINARY（50）`。假设该列信息使用单个字符集编码，你可以将它转换为一个原字符集非十六进制列。例如，如果 `col1` 中包含二进制数据，代表希腊字符集的字符，你可以将它转换如下：

```sql
ALTER TABLE t MODIFY col1 VARCHAR(50) CHARACTER SET greek;
```

如果你的原始列还有个 `BINARY(50)` 的类型，你可以转换成 `CHAR（50）`，不过结果值将会用 `0x00` 字节填充在尾部，这可能是不理想的。要删除这些字节，使用 [TRIM（）]() 函数：

```sql
UPDATE t SET col1 = TRIM(TRAILING 0x00 FROM col1);
```

假定表 `t` 用一个定义成 ` CHAR(50) CHARACTER SET latin1` 的非十六进制的列 `col1`，但你想转换成 `utf8` 以至于你可以存储许多语言的值。下面的语句实现这一点：

```sql
ALTER TABLE t MODIFY col1 CHAR(50) CHARACTER SET utf8;
```

转换可能有损如果列包含字符不在两个字符集内。

一个特殊情况是，如果你有从MySQL4.1以前版本来的旧表，其中非十六进制列值实际上编码字符集与服务器的默认字符集不同。例如，一个应用程序可能在一列存储 `sjis` 值，即使MySQL的默认字符集是 `latin1`。可能转换列使用正确的字符集，但需要一个额外的步骤。假设服务器的默认字符集是 `latin1` 和 `col1` 被定义成 `CHA（50）` 但内容是 `sjis` 值。第一个步是转换列成一个十六进制数据类型，从而消除了现有的字符集信息而不执行任何字符转换：

```sql
ALTER TABLE t MODIFY col1 BLOB;
```

下一步是转换列成带有正确字符集的非十六进制数据类型：

```sql
ALTER TABLE t MODIFY col1 CHAR(50) CHARACTER SET sjis;
```

此过程要求表中已经升级到MySQL4.1或更高版本后，没有被修改如INSERT或UPDATE语句。在这种情况下，MySQL将存储新的数值以latin1列，该列将包含使用 `sjis`和 `latin1` 的混合不能被正确转换。

如果最初创建列时指定的属性，修改表时你也应该指定用 [ALTER TABLE]() 。例如，如果你指定 `NOT NULL` 和明确的 `DEFAULT` 值，你也应该为他们提供在 [ALTER TABLE]() 语句。否则，由此产生的列定义将不包括这些属性。
