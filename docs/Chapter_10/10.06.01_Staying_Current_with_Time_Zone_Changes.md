# 10.6.1. 时区改变时保持当前

### 10.6.1. 时区改变时保持当前

就像之前提到，当时区规则改变时，应用程序使用老的规则变成过时的。为了保持当前，它是有必要去确认您的系统使用的当前系统时区。对于MySQL，保持当前有两个因素需要考虑：

* 操作系统时间影响MySQL使用的时间值，如果它的时区被设置成 `SYSTEM`。确定你的操作系统最后一次使用的时区信息。对于绝大部分操作系统，最后一个更新或者服务包准备你系统的时间改变。检查您的操作系统供应商为解决时间变化的Web站点更新。

* 如果你替换系统 `/etc/localtime` 时区文件时用与他们不同规则的版本影响是在 [mysqld]() 启动时，你应当重启  [mysqld]() 以便使用更新后的规则。否则，[mysqld]() 没能注意到系统修改了它的时间。

* 如果你在MySQL内使用命名时区，确保时区mysql数据库中的表是最新的。如果你的系统拥有自己的时区数据库，您应该重新载入MySQL的时区表当时区数据库更新时，使用在本节前面的指示。对于系统没有自己的时区数据库，检查MySQL开发者专区更新。当一个更新就绪，下载并使用它去替换你当前的时区表。[mysqld]() 缓存时区信息便于查找，因此替换时区表知乎，你应当重启 [mysqld]() 以确保它不会继续服务过时的时区数据。


如果你不确定命名时区是否就绪，无论是作为服务器的时区设置，或由客户自己的时区设置，检查您的时区表是否为空。接下来的查询决定表是否包含任何行的命名时区：

```sql

mysql> SELECT COUNT(*) FROM mysql.time_zone_name;
+----------+
| COUNT(*) |
+----------+
|        0 |
+----------+
```

计数为0指出表是空的。这种情况下，没有一个可使用的命名时区，且你不需要更新这个表。计数大于0表明表是不空的并它的内容可用为命名时区支持。这种情况下，你应当确保重新装载时区表以便任何使用命名时区的人将得到正确的查询结果。

检查你的MySQL安装是否正确更新为了变更为夏令时规则，使用如下测试。该用例值适用于2007年夏令时1-小时变更发生于美国3月11日凌晨2点。

测试使用如下两个查询：

```sql
SELECT CONVERT_TZ('2007-03-11 2:00:00','US/Eastern','US/Central');
SELECT CONVERT_TZ('2007-03-11 3:00:00','US/Eastern','US/Central');
```

这两个时间值指出这时间在DST（美国夏令时）改变是发生，并且命名时区的使用需要时区表被使用。期望的结果是两个查询都返回相同的结果（输入时间，转换成相同的值在美国中部时区）。

在更新时区表之前，你可能见到像这样不正确的结果：

```sql
mysql> SELECT CONVERT_TZ('2007-03-11 2:00:00','US/Eastern','US/Central');
+------------------------------------------------------------+
| CONVERT_TZ('2007-03-11 2:00:00','US/Eastern','US/Central') |
+------------------------------------------------------------+
| 2007-03-11 01:00:00                                        |
+------------------------------------------------------------+

mysql> SELECT CONVERT_TZ('2007-03-11 3:00:00','US/Eastern','US/Central');
+------------------------------------------------------------+
| CONVERT_TZ('2007-03-11 3:00:00','US/Eastern','US/Central') |
+------------------------------------------------------------+
| 2007-03-11 02:00:00                                        |
+------------------------------------------------------------+
```

更新表之后，你应该看到正确的结果：

```sql
mysql> SELECT CONVERT_TZ('2007-03-11 2:00:00','US/Eastern','US/Central');
+------------------------------------------------------------+
| CONVERT_TZ('2007-03-11 2:00:00','US/Eastern','US/Central') |
+------------------------------------------------------------+
| 2007-03-11 01:00:00                                        |
+------------------------------------------------------------+

mysql> SELECT CONVERT_TZ('2007-03-11 3:00:00','US/Eastern','US/Central');
+------------------------------------------------------------+
| CONVERT_TZ('2007-03-11 3:00:00','US/Eastern','US/Central') |
+------------------------------------------------------------+
| 2007-03-11 01:00:00                                        |
+------------------------------------------------------------+
```
