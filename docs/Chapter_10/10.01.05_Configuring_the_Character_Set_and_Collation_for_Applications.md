# 10.1.5. 配置程序字符集和校对规则

### 10.1.5. 配置程序字符集和校对规则

对应用程序而言，存储数据使用默认的MySQL字符集和校对规则（`latin1`,`latin1_swedish_ci`）,不需要特殊的配置。如果应用程序要求数据存储使用不同的字符集或者校对规则，你可以配置字符集信息如下几种方式：

* 指定字符设置为每个数据库。例如，应用程序要一个数据库必须使用 `utf8`，然而应用程序要求其他的数据库使用 `sjis`。
* 指定字符设置在服务器启动时。这将导致服务器使用给定的设置，所有应用程序不作其他布置。
* 指定字符设置在配置时，如果你从源码编译MySQL。这导致服务器使用给点的设置为所有的运用程序，在服务器启动时，不再需要指定他们。

当不同的应用程序要求不同的字符设置，每个数据库技术（指上面的第一种方式）提供了大量的灵活性。如果绝大部分应用程序使用相同的字符集，在服务器启动或者编译配置时指定字符设置更方便。

每个数据库或者服务器启动技术，这些设置控制数据存储的字符集。应用程序还必须告诉服务器在客户机/服务器通信中使用的字符集，下面的说明中所描述的。

这些例子所显示，都假定使用 `utf8`字符集和 `utf8_general_ci`校对规则。

**指定字符集设置每个数据库**。创建一个数据库，他所有的表为数据存储都将使用一个给定的默认字符集和校对规则，像这样使用 [CREATE DATABASE]() 子句：

```sql
CREATE DATABASE mydb
   DEFAULT CHARACTER SET utf8
   DEFAULT COLLATE utf8_general_ci;
```

创建在这个数据库下表都将使用 `utf8` 和 `utf8_general_ci` 默认为所有字符字段。

使用数据库的应用程序还应该在每次连接到服务器时配置连接。这是可以连接后通过执行一个 `SET  NAMES 'UTF8'`语句做到。这语句可以用在无论何种连接方式：mysql客户端，PHP脚本，等等。

在某些情况下，它尽可能的配置连接使用所渴望的字符集其他方式。打个比方，使用 [mysql]() 连接，你可以指定 [--default-character-set=utf8]() 命令行选项来实现与 `SET NAMES 
'utf8'` 相同的效果。

关于更多的配置客户端连接信息，详见 [10.1.4小节，“连接字符集和校对规则”](./10.01.04_Connection_Character_Sets_and_Collations.md)。


如果你改变了一个数据库的默认字符集和校对规则，使用这个数据库默认的存储程序必须删除然后重建，这样他们才可以使用新的默认值。（在一个存储程序中，如果字符集和校对规则没有特别明确指定，字符数据类型的变量使用数据库默认。详见 [13.1.15小节，“`CREATE PROCEDURE` 和 `CREATE FUNCTION` 语法”](../Chapter_13/13.01.15_CREATE_PROCEDURE_and_CREATE_FUNCTION_Syntax.md)）

**指定字符集设置在服务器启动时**。在服务器启动时选择一个字符集和校对规则，使用 [--character-set-server]() 和 [--collation-server]() 选项。例如，指定这些选项在配置文件中，包含如下这些行：
```
[mysqld]
character-set-server=utf8
collation-server=utf8_general_ci
```

这些设置应用与服务器级别和应用于任何一个应用程序创建数据库默认，并且在这些数据库中创建表格。

依然很有必要为应用程序使用 `SET NAMES`配置他们的连接或者同样在他们连接之后，像之前描述的一样。你可能被勾引在启动服务器带 [--init_connect="SET NAMES 'utf8'"]() 选项，去促成每个客户端在连接的时候自动执行 `SET NAMES`。无论如何，这会产生不一致的结果，因为 [init_connect]() 的值没有被有 [SUPER]() 权限的用户执行。

**指定字符集设置在MySQL编译时**。选择一个字符集和校对规则在你从源码编译MySQL时，使用 `CMake`的 [DEFAULT_CHARSET]() 和 [DEFAULT_COLLATION]() 选项：

```shell
shell> cmake . -DDEFAULT_CHARSET=utf8 \
         -DDEFAULT_COLLATION=utf8_general_ci
```

这个编译好的服务器使用 `utf8` 和 `utf8_general_ci` 做为数据库、表和每个客户端连接的默认。没有必要在服务器启动时去使用 [--character-set-server]() 和 [--collation-server]() 指定这些默认。也没有必要为应用程序使用 `SET NAMES` 配置他们的连接或者同样在连接到服务器之后配置。

不管你如何配置数据库的字符集给应用程序使用，你必须认清这些应用程序执行所在的环境。如果你在编辑器中创建一个文件，使用UTF-8文本将报表发送，你应当在你的环境的语言环境设置成UTF-8来编辑文件，以便这文件编码是正确的并且一边操作系统正确地处理它。如果你从一个终端窗口使用 [mysql]() 客户端，窗口必须被配置为使用UTF-8字符或者可能无法正确显示。对于在Web环境中执行的脚本，该脚本与MySQL服务器交互时必须妥善处理的字符编码​​，它必须生成页面，并正确显示编码，以便浏览器知道如何显示网页的内容。例如，你可以包含 `<meta>` 标签在你的 `<head>` 元素内：

```html
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
```