### 8.2.2.优化DML语句

这一节解释怎样来加速数据操作语言（DML）语句，**INSERT,UPDATE**和**DELETE**。传统的OLTP应用和现代的web应用代表性地都会做一些小的DML操作，这些场景的并发性是至关重要的。数据分析和报告应用代表性地运行那些一次影响很多行的DML操作，这些场景主要考虑的是写入大量数据和保持索引最新的I/O。对于插入和更新大量数据（在业界被称为ETL,提取转换加载（extract-transform-load）），有时你可以使用其他的SQL语句或者外部命令，模仿**INSERT,UPDATE**和**DELETE**语句的效果。

#### [8.2.2.1.INSERT语句的速度](#08.02.02.01)

要优化插入速度，将多个小操作组合成一个大操作。理想地，你只用了一个连接，将数据一次发送到很多行，延迟了所有索引的更新和一致性检查直到全部完毕。

插入一个记录需要的时间由下列因素组成，其中的数字表示大约比例：

* 连接：(3) 

* 发送查询给服务器：(2) 

* 分析查询：(2) 

* 插入记录：（1x记录大小） 

* 插入索引：（1x索引） 

* 关闭：(1) 

这不考虑打开表的初始开销，每个并发运行的查询打开。

表的大小以logN (B树)的速度减慢索引的插入。

加快插入的一些方法：

* 如果同时从同一个客户端插入很多行，使用含多个**VALUE**的**INSERT**语句同时插入几行。这比使用单行**INSERT**语句快(在某些情况下快几倍)。如果你正向一个非空表添加数据，可以调节**bulk_insert_buffer_size**变量，使数据插入更快。参见[章节5.1.4节，“服务器系统变量”][5.1.4]。

* 当从一个文本文件装载一个表时，使用**LOAD DATA INFILE**。这通常比使用很多**INSERT**语句快20倍。参见[章节13.2.6节，“LOAD DATA INFILE语法”][13.2.6]。

* 充分利用列有默认值的事实。只有当插入的值不同于默认值时，才明确地插入值。这减少MySQL需要做的语法分析从而提高插入速度。

* 参见[章节8.5.4,“InnoDB表的批量数据加载”][8.5.4]**InnoDB**表特定的提示

* 参见[章节8.6.2,“MyISAM表的批量数据加载”][8.6.2]**MyISAM**表特定的提示

#### [8.2.2.2.UPDATE语句的速度](#08.02.02.02)

更新查询的优化同**SELECT**查询一样，需要额外的写开销。写速度依赖于更新的数据大小和更新的索引的数量。没有更改的索引不被更新。

使更改更快的另一个方法是推迟更改然后在一行内进行多次更新。如果锁定表，同时做多个更新比一次做一个快得多。

请注意对使用动态记录格式的**MyISAM**表，更新一个较长总长的记录可能会切分记录。如果经常这样该，偶尔使用**OPTIMIZE TABLE**很重要。参见[章节13.7.2.4，“OPTIMIZE TABLE语法”][13.7.2.4]。

#### [8.2.2.3.DELETE语句的速度](#08.02.02.03)

删除**MyISAM**表的一个记录的时间与索引数量确切成正比。为了更快速地删除记录，可以提高**key_buffer_size**系统变量来增加缓冲的大小。参见[章节8.11.2，“调节服务器参数”][8.11.2]。

如果想要删除一个**MyISAM**表的所有行，使用**TRUNCATE TABLE tbl_name**比使用**DELETE FROM tbl_name**更快。Truncate操作不是事务安全的；当在一个活动事务或活动表锁的过程中尝试一次，会发生错误。查看[章节13.1.33，“TRUNCATE TABLE语法”][13.1.33]


















[5.1.4]:./docs/05.01.04_Server_System_Variables.md
[13.2.6]:./docs/13.02.06_LOAD_DATA_INFILE_Syntax.md
[8.5.4]:./docs/08.05.04_Bulk_Data_Loading_for_InnoDB_Tables.md

[8.6.2]:./docs/08.06.02_Bulk_Data_Loading_for_MyISAM_Tables.md
[13.7.2.4]:./docs/13.07.02_Table_Maintenance_Statements.md#13.07.02.04
[8.11.2]:./docs/08.11.02_Tuning_Server_Paramters.md

[13.1.33]:./docs/13.01.33_TRUNCATE_TABLE_Syntax.md