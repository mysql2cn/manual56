### 8.8.4. Estimating Query Performance

在大多数情况下，你可以通过计算磁盘查找数估计查询代价。对小表，你通常可以通过一次磁盘定位找到一条记录（因为可能缓存索引）。对大表，你可以估计在使用B-tree索引的情况下，可能使用下面的查找次数找到一条记录：log(row_count) / log(index_block_length / 3 * 2 / (index_length + data_pointer_length)) + 1

在 MySQL ，索引块通常是 1024 字节，数据指针通常 4 字节。对一个 500000 记录主键 3 字节（MEDIUMINT类型）的表，通过公式可得出磁盘查找次数为 log(500,000)/log(1024/3*2/(3+4)) + 1 = 4 次。

这个索引需要存储大约 500,000 * 7 * 3/2=5.2MB（假设一个典型的索引 buffer 填充率是 2/3 ），因此大部分索引是在内存中的，可能仅需要一或二次调用找到记录。

但通常对写操作而言，需要四次请求找到索引值存放的位置，两次请求来更新索引和写记录。

注意之前的讨论并不意味着你应用程序性能退化到log N。只要所有内容都缓存在 OS 或者 MySQL 服务里，表的增大对性能的影响微乎其微。当表变的太大而无法缓存，并且你的应用程序与磁盘访问紧密相连时，性能才开始变差（遵循log N曲线）。为避免这种情况，随着数据增长增加键缓存大小。对MyISAM表，键缓存通过 key_buffer_size 系统变量来控制。查看[ Section 5.1.1, “Configuring the Server”]()。