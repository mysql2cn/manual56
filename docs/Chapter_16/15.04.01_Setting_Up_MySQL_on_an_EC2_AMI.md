# 15.4.1. 在亚马逊EC2实例上使用MySQL

### 15.4.1. 在亚马逊EC2实例上使用MySQL

在EC2 AMI中设置MySQL有很多种方式，其中包括使用亚马逊预先配置好的AMI。

亚马逊提供的默认入门AMI基于Fedora Core 4，你可以使用下面的**yum**命令来安装MySQL：

```
shell> yum install mysql
```

这个命令将安装MySQL服务器以及Perl DBI API需要的Perl DBD::mysql驱动程序。

或者，你也可以使用在标准安装中带有MySQL的AMI。

最后，你也可以安装从MySQL网站下载的MySQL标准版。安装过程和步骤和在Linux上的其他任何MySQL安装是一样的。参见第二章，安装和升级MySQL。

标准的MySQL配置将数据文件存放在默认位置，/var/lib/mysql。EC2实例上的默认数据目录是/mnt（不过在大型和极大型实例上你可以更改这项配置）。编辑/etc/my.cnf文件来将datadir选项设置为更大的存储区域。

> **重要**

> EC2实例上的主存储区在第一次使用前需要初始化。初始化过程在你第一次对设备进行写操作时会自动开始。你可以立即开始使用设备，但是在初始化过程完成之前，新设备的写性能会显著地很差。

> 为了在设置新实例时避免这个问题，你应该在使用MySQL数据库之前开始初始化过程。其中一个方法是利用**dd**来对文件系统进行写操作。

> ```
  root-shell> dd if=/dev/zero of=initialize bs=1024M count=50
  ```

> 这条命令会在文件系统创建一个50GB的文件并开始初始化过程。初始化完成后可以将这个文件删除。

> 初始化过程可能会需要很长时间。小型实例的初始化可能需要2到3个小时。而对于大型和极大型实例，这个过程可能分别是10和20小时。

除了为MySQL数据文件设置正确的存储区以外，在保存用来部署的实例配置时还应该考虑下面几个设置：

* 设置MySQL服务器ID，以便当你需要使用复制时，ID已经被正确设置好。

* 启用二进制日志，以便当需要使用复制时无需再重新启动服务器。

* 为你的存储引擎设置缓存和内存配置参数。EC2环境对存储引擎的使用没有限制或者局限。对于你将要部署的实例，选择MySQL提供的适合的标准配置。大型和极大型实例上的内存可以用来专门分配给缓存。请注意如果你选择作为应用程序架构的一部分在你的服务器上安装**memcached**，那么你需要留有足够的内存给MySQL和**memcached**。

将AMI上的MySQL和应用程序架构的其他部分设置好以后，保存这个AMI以便可以部署和重用这个实例。

在AMI中设置好你的应用程序架构以后，就可以利用**mysqldump**来创建一份你的数据库的转储，将这份转储转移到EC2实例，然后将其重装到EC2实例的数据库中。

在生产环境中使用实例之前，请注意EC2实例环境的限制。参见[15.4.2. EC2实例的局限性](./15.4.2_EC2_Instance_Limitations.md)。开始使用你的MySQL AMI以前，查阅部署文档。参见[15.4.3. 使用EC2来部署MySQL数据库](./15.4.3_Deploying_a_MySQL_Database_Using_EC2.md)