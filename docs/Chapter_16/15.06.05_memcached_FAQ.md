# 15.6.5. memcached FAQ

### 15.6.5. memcached FAQ

问题

* [15.6.5.1](#15.06.05.01)： memcached是否可以在Windows环境运行？

* [15.6.5.2](#15.06.05.02)：在memcached中可存储的最大对象大小是多少？这个大小可以配置吗？

* [15.6.5.3](#15.06.05.03)：**memcached** 在DB读取密集型应用中比在DB写密集型应用中更有效是否正确？

* [15.6.5.4](#15.06.05.04)：不使用持久连接是否会有额外开销？如果总是推荐适用持久连接，那么它的缺点是什么（比如，查找）？

* [15.6.5.5](#15.06.05.05)：**memcached** 是如何处理像某个 **memcached** 服务器崩溃这样的事件的？

* [15.6.5.6](#15.06.05.06)：运行memcached服务器的推荐硬件配置是什么？

* [15.6.5.7](#15.06.05.07)：与文本读取相比，memcached会对视频和音频更有效吗？

* [15.6.5.8](#15.06.05.08)：**memcached** 是否可以用于ASPX？

* [15.6.5.9](#15.06.05.09)：建立一个memcache连接的开销有多大？应该使用连接池吗？

* [15.6.5.10](#15.06.05.10)：**memcached** 服务器崩溃时数据如何处理？

* [15.6.5.11](#15.06.05.11)：MySQL数据库中的自增长列如何与多个memcached实例协调？

* [15.6.5.12](#15.06.05.12)：支持压缩吗？

* [15.6.5.13](#15.06.05.13)：是否可以在同一台服务器上实现不同类型的 **memcached** 作为不同的节点，从而在同一服务器实现确定性与不确定性？

* [15.6.5.14](#15.06.05.14)：为确保性能提升，以及衡量 **memcached** 配置更改的影响，如何最好地测试实施？是否推荐使用很简单的配置作为起始？

问题与回答

**<a name="15.06.05.01"/>15.6.5.1</a>： memcached是否可以在Windows环境运行？**

不可以。目前 **memcached** 只在Unix/Linux平台上可用。有非官方的实现可用，参见[http://www.codeplex.com/memcachedproviders](http://www.codeplex.com/memcachedproviders)。

**<a name="15.06.05.02"/>15.6.5.2</a>：在memcached中可存储的最大对象大小是多少？这个大小可以配置吗？**

默认的最大对象大小是1MB。在 **memcached** 1.4.2及以后版本中，可以通过 **-I** 命令行选项来更改最大对象大小。

在这之前的版本中，要增加这个大小需要重新编译 **memcached**。可以修改源代码中 **slabs.c** 文件中 **POWER_BLOCK**的值。

在 **memcached** 1.4.2及以后版本中，可以通过 **-I** 命令行选项来配置支持的最大对象大小。例如，要将最大对象大小增加到5MB：

```
$ memcached -I 5m
```

如果一个对象大小超过了最大对象大小限制，可以手动将其分割。**memcached**运作很简单：你交给它一个键和一些数据，它就试着在RAM中缓存这些。如果你试图存储超过默认最大对象大小的数据，为保证速度这个数据就会被清除。

**<a name="15.06.05.03"/>15.6.5.3</a> memcached在DB读取密集型应用中比在DB写密集型应用中更有效是否正确？**

是。**memcached** 对数据库写不起作用，它是一个用来在RAM中缓存已经从数据库中读出的数据的方法。

**<a name="15.06.05.04"/>15.6.5.4</a> 不使用持久连接是否会有额外开销？如果总是推荐适用持久连接，那么它的缺点是什么（比如，查找）？**

如果在与 **memcached** 通讯时不适用持久连接，每次开启新的连接时的延迟会有一个小的增加。这个影响与使用非持久连接访问MySQL相似。

一般来说，使用持久连接遇到锁定或其他问题的机会很小，因为 **memcached** 锁机制的使用很少。如果碰到这样的问题，最终你的请求会超时并无法返回结果，这时应用程序需要从MySQL中重新加载数据。

**<a name="15.06.05.05"/>15.6.5.5</a> memcached是如何处理像某个memcached服务器崩溃这样的事件的？**

这种问题没有自动处理机制。如果客户端无法从服务器端得到反馈，则需要写一个后备机制来从MySQL数据库中加载数据。

客户端API都会提供运行时添加或移除 **memcached** 实例的能力。如果应用程序意识到 **memcached** 服务器不再有回应，可以将其从服务器列表中移除，该服务器上粗处的键值会被自动重新分配到列表中另外的 **memcached** 服务器上。如果在所有服务器中保持缓存内容很重要，要确保使用支持一致哈希算法的API。更多信息，参见[15.6.2.4节，“memcached 哈希/分布类型”](./15.06.02_Using_memcached.md#15.06.02.04)。

**<a name="15.06.05.06"/>15.6.5.6</a> 运行memcached服务器的推荐硬件配置是什么？**

**memcached** 的处理开销很小。需要的只是多余的物理RAM容量。**memcached** 服务器不需要专用的服务器。如果已有的网络，应用，或者数据库服务器有多余的内存，就可以使用他们来运行 **memcached** 。

要构建并部署专用的 **memcached** 服务器，选择一个相对较低性能的CPU，很多的RAM，以及一个或多个千兆网络接口。

**<a name="15.06.05.07"/>15.6.5.7</a> 与文本读取相比，memcached会对视频和音频更有效吗？**

**memcached** 对于所有类型的数据具有同等的效果。对于 **memcached** 来说，任何你存储的数据只是一个数据流。但记住，在 **memcached** 中可存储的最大对象大小为1MB，但是可以在 **memcached** 1.42或之后版本中使用 **-I** 选项来修改，或者在1.42之前版本中修改源代码来改变。如果计划使用 **memcached** 来缓存音频和视频数据，你可能需要增加最大对象大小。还有要记住 **memcached** 是缓存读取信息的方案。它不应被用在写方案中，除非要更新缓存中的信息。

**<a name="15.06.05.08"/>15.6.5.8</a> memcached是否可以用于ASPX？**

有针对很多语言和环境的port和接口。ASPX依赖例如C#或VisualBasic的底层语言，如果使用ASP.NET，有C# **memcached**库可用。更多信息，参见[https://sourceforge.net/projects/memcacheddotnet/](https://sourceforge.net/projects/memcacheddotnet/)。

**<a name="15.06.05.09"/>15.6.5.9</a> 建立一个memcache连接的开销有多大？应该使用连接池吗？**

开启一个连接相对来说开销不大，因为在可以开始发送请求和获得返回结果之前没有安全检查，身份验证或者其他的握手协议。大多数API都支持到 **memcached** 实例的持久连接来减小延迟。连接池的性能依赖于使用的API，但是如果直接使用TCP/IP通讯，连接池会带来一些小的性能提升。

**<a name="15.06.05.10"/>15.6.5.10</a> memcached服务器崩溃时数据如何处理？**

服务器崩溃时的行为完全依赖于应用程序。多数应用程序会到数据库重新载入数据（就像在更新 **memcached** 信息一样）。如果使用多台 **memcached** 服务器，还可以将崩溃的服务器从列表中移除来避免影响性能。否则客户端依旧会试图与试图加载的键信息所在的 **memcached** 服务器通讯。

**<a name="15.06.05.11"/>15.6.5.11</a> MySQL数据库中的自增长列如何与多个memcached实例协调？**

自增列无法与多个memcached实例协调。MySQL和 **memcached** 没有关系，除非应用程序（或者，如果针对 **memcached** 使用MySQL UDF，这时则是数据库定义）建立这样的关系。

如果根据自增列来将信息存储到多个 **memcached** 实例，信息只会存放在其中一台 **memcached** 实例上。客户端更具键值来决定将信息存放在哪一台 **memcached** 实例上。同样的信息不会被存储在多台实例上，因为那样对缓存内存是一种浪费。

**<a name="15.06.05.12"/>15.6.5.12</a> memcached支持压缩吗？**

支持。多数客户端API支持某些种类的压缩，有些甚至允许指定一个阈值来决定什么样的值在存储时适合使用压缩。

**<a name="15.06.05.13"/>15.6.5.13</a> 是否可以在同一台服务器上实现不同类型的memcached作为不同的节点，从而在同一服务器实现确定性与不确定性？**

可以。在一台服务器上可以运行多个 **memcached** 实例，而在客户端配置中选择要使用的服务器列表。

**<a name="15.06.05.14"/>15.6.5.14</a> 为确保性能提升，以及衡量memcached配置更改的影响，如何最好地测试实施？是否推荐使用很简单的配置作为起始？**

测试性能的最好方式是启动一个 **memcached** 实例。首先，修改应用程序使其将要使用或显示的信息存储到 **memcached** 中。因为API会处理数据的序列化，要修改的代码应该只有一行。然后，将一般要从MySQL中载入信息的进程修改为从 **memcached** 请求数据的代码。如果数据无法从 **memcached** 中载入，再使用MySQL进程读取。

所有需要的改变应该值只有几行代码的修改。要达到最佳性能，确保缓存整个对象（例如，一个网页、博客、讨论主题等等的所有组件），而不是将 **memcached** 用作MySQL表中单个行的简单缓存。

在开始时使用简洁配置，或者长期来说也使用简洁配置，对于使用 **memcached** 是一种简单方式。一旦基础结构开始运行，通常唯一需要的改变就是向应用程序使用的服务器列表中添加更多服务器。不需要管理 **memcached** 服务器，也没有复杂的配置；只需要添加服务器到列表中，然后让客户端API和 **memcached** 服务器来做决定。

