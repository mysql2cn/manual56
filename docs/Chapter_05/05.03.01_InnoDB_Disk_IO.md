# 5.3.1 InnoDB 磁盘I/O

###5.3.1 InnoDB 磁盘I/O

InnoDB 通过创建若干个线程来管理I/O操作，尽可能地使用异步磁盘I/O调度，当数据库的其他操作需要优先使用I/O时，这些线程用于调度进行中的操作。在Linux和Windows平台，InnoDB使用操作系统和函数库来进行“本地” 异步I/O调度。在其他平台，InnoDB任然使用I/O线程，而且这些线程事实上会等待当前I/O请求完成；这中技术被称为‘伪’异步I/O。

<b>Read-Ahead（预读）</b>

如果InnoDB可确定数据有很高的可能性被马上使用，这时，InnoDB会使用预读方式将这些数据读取到内存主缓存中。对磁盘上连续数据进行少量较大的读请求比进行大量较小的分散的请求效率会更高，在InnoDB中，有2种预读方式：
*顺序预读，如果InnoDB发现以连续模式读取表空间的一个片段，它将向I/O系统发起后续一批数据的读取。
*随机模式，如果InnoDB发现表空间中一部分正在完整地读取到主缓存中，它将发起剩下数据的读取

<b>Doublewrite Buffer（两次写缓存）</b>

InnoDB使用一个包含两次写缓存的磁盘刷新机制。这种方式增加了在系统崩溃或者宕机后数据恢复的安全性，对大多数Unix系统减少了对fsync（）操作的的调用从而得到性能提升。

在数据刷新到磁盘的过程中，在将数据页写入数据文件中之前，InoDB先把数据页写入到一段连续的表空间中（doublewrite buffer）。只有在两次写缓存被写入并刷新到缓存后InnoDB才将数据页写到数据文件中特定位置。如果系统在数据页写入过程中崩溃（产生断裂的数据页），InnoDB在恢复过程中可以从两次写缓存中找到一份完整的副本来完成数据恢复。
