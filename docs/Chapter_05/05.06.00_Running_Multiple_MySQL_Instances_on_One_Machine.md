# 5.6 在同一台机器上运行多个MySQL服务器

## 5.6 在同一台机器上运行多个MySQL服务器

在一些情况下, 你可能想要在同一台机器上运行多个MySQL服务器, 你可能想要测试一个新的MySQL发行版, 同时不影响现有产品的设置, 或者, 你可以能想使不同用户访问不同的`mysqld`服务器以便他们自己来管理(例如, 你可能是一个Internet服务提供商, 希望为不同的客户提供独立的MySQL安装环境)。

每个实例使用不同的MySQL二进制服务器, 或者在多个实例上使用相同的二进制, 或这两种方法的任意组合, 这些方法都是可行的, 比如, 你也许在一台服务器上运行MySQL5.5, 同时在另一台上运行MySQL5.6, 看看不同版本是如何处理给定的负载。或你会运行着当前生产版本的多个实例, 每个实例管理一组不同的数据库。

无论你是不是使用不同的服务器二进制文件, 运行着的每个实例上必须有唯一的各运行参数值, 这会消除实例之间发生冲突的可能性, 这些值可以在命令行中或者在选项文件设置以及可以在环境变量中设置, 请参考4.2.3节, "指定程序选项", 要查看这些实例, 连接到实例并执行`SHOW VARIABLES`语句。

MySQL实例管理的主要资源是数据目录。每个实例应使用不同的数据目录, 可以通过 `--datadir=path`选项来指定该目录, 对于每个实例配置其自己的数据目录的方法，不这样做的危险警告。请参考第5.6.1节,"设置多个数据目录"。

除了使用不同的数据目录外, 每一台服务器实例上的多个其他选项也必须有不同的值。

* `--port=port_num`

`--port`控制着TCP/IP连接的端口号, 另外, 如果主机有多个不同的网络地址, 你可以使用`-bind-address`来让每个服务器监听不同的地址。

* `--sock=path`
 
`--sock`控制着Unix中Unix套接字文件路径和在Windows中的命名管道名称, 在Windows中, 只有支持命名管道连接的服务器才需要明确指定管道名称。

* `--shared-memory-base-name=name`

该选项仅在Window中支持, 它由Windows服务器指定使用, 允许客户端通过共享内存来连接的共享内存名, 这是为那些需要配置为允许使用共享内存连接的服务器指定不同的共享内存名的。

* `--pid-file=file_name`

该选项仅在Unix中使用, 它指出服务器在其中写入进程ID的文件名。

如果你使用下面的日志文件选项, 对于每台服务器来说, 它们必须是不同的:

* `--general_log_file=file_name`

* `--log-bin[=file_name]`
 
* `--slow_query_log_file=file_name`
 
* `--log-error[=file_name]`

更多关于日志文件选项的讨论, 请参考5.2节, "MySQL服务器日志"。

为了得到更好的性能, 你可以在每台服务器上指定下列选项的不同的值, 以便在物理磁盘之间平均分配负荷:

* `--tmpdir=path`

使用不同的临时目录, 以便容易地确定是哪个MySQL服务器创建了给定的临时文件。

如果要将多个MySQL安装到在不同的位置, 一般情况下可以用`--basedir=path`选项为每台服务器指定基本的安装目录, 是每台服务器实例自动使用不同的数据目录, 日志文件和PID文件, 这是因为这些值得默认是都是相对根目录来确定的。在这种情况下, 你唯一需要指定的其他选项是`--socket`和`--port`选项, 假设使用tar文件二进制分发版安装不同的MySQL版本, 这些安装在不同的位置, 因此可以使用各个安装服务器相应的根目录中的`bin/mysqld_safe`命令来启动服务器。`mysqld_safe`确定正确的`--basedir`选项传递给`mysqld`, 你仅需要为`mysqld_safe`指定`--socke`t和 `--port`选项。

正如下面几节讨论的那样, 可以通过设置环境变量或者用指定的命令行参数来启动更多的服务器, 但是, 如果你需要在一个更稳定的基础上运行多台服务器, 一个更方便的办法是使用选项文件来为每台服务器指定那些选项值, 它对每台服务器必须是唯一的, 对于这个目的, 选项 `--default-file`是非常有用的。

