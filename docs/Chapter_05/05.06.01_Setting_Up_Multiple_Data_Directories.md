# 5.6.1 设置多个数据目录

### 5.6.1 设置多个数据目录

每个MySQL实例的机器上都应该有其自己的数据目录, 该位置是由`--datadir=path`选项指定的。

设置一个新实例的数据目录有几种不同的方法：

* 创建一个新的数据目录

* 复制现有的数据目录

下面的讨论提供每种方法的更多细节:

警告: 

一般情况, 你决不要让两台服务器更新相同数据库中的数据。否则, 如果你的操作系统不支持故障排除系统锁定, 该可能会导致非常奇怪的结果。如果（不理会该警告）运行的多个服务器使用相同的数据目录并且启用了日志记录, 你必须使用适当的选项来为每个服务器指定唯一的日志文件名。否则, 服务器尝试用相同的文件来记录日志。

即使注意到上述警告, 请注意这种类型的设置只能在MyISAM和MERGE表上工作, 对其它任何存储引擎不起作用。多个服务器共享一个数据目录的警告也适用于NFS环境。允许多个MySQL服务器通过NFS访问一个共同的数据目录是一个非常不好的主意, 主要问题是NFS存在速度瓶颈。它不是用于这种用途。

用NFS的另一个冒险是你必须提出一个方法来确保两台或多台服务器不会相互干扰。NFS文件的锁定通常由lockd后台程序处理, 但是目前, 没有一个运行平台能够在每种情况下100%可靠地进行锁定。

#### 创建一个新的数据目录

使用这种方法, 当你第一次安装MySQL时, 数据目录将会在相同的状态, 它会有MySQL账户的默认设置, 但是没有用户数据。

在Unix上, 运行`mysql_install_db`去初始化数据目录, 参考2.10.1节, "Unix安装后的程序"。

在Windows上，数据目录包含在MySQL分发版中: 

Windows下的MySQL Zip归档分发版中包含未经修改的数据目录, 你可以解压这样的分发包到一个临时位置, 然后将其数据目录复制到你设定的新实例下。

Windows MSI安装包会创建和设置安装服务将使用的数据目录, 但是还在安装目录下创建一个名为data的原始"模板"数据目录。在使用MSI包完成安装后,可以复制临时数据目录去设置其他MySQL实例。

#### 复制现有的数据目录

使用这种方法, 任何MySQL账户或者数据目录中的用户数据都被转入到新的数据目录中去。

1. 停止使用现有数据目录中的MySQL实例, 这关闭必须是干净的, 实例没有任何刷新等待写到到磁盘中。

2. 复制数据目录到新的数据目录应该在的位置。

3. 复制现有实例正在使用的`my.cnf`或者`my.ini`选项文件, 作为新实例的基础。

4. 修改选项文件, 使任何指到原始数据目录的路径名指向新的数据目录。此外, 修改之前实例的必须是唯一的任何其他选项, 如TCP/IP端口号和日志文件。对于每个实例必须是唯一的参数列表，请参考5.6节, "在一台机器上运行多个MySQL实例"。

5. 启动新的实例，告诉它使用新的选项文件。 
