##1.7 如何报告Bug与问题

  当提交一个问题的报告之前，请检查一下是否这是一个Bug并且没有被他人提交过：
  
  + 先搜索一下[MySQL在线手册](http://dev.mysql.com/doc)，我们会尽量经常更新手册保持其为最新版本，并添加最新发现的问题及其解决办法。另外，手册中的版本发布信息通常很有用，因为新版很可能会包含你遇到的问题的解决方法。发布信息可以在列出的手册地址里面找到。
  
  + 如果你遇到了SQL语句的解析错误，请先检查一下语法问题。如果找不到错误，很可能是所使用的MySQL服务器版本不支持你所用的语法。如果你正在使用的版本和手册没有包含你用的语法，那MySQL服务器就不能支持你的SQL语句。
  
    如果手册中包含你所使用的语法，但是你使用的是老版本的MySQL，那么就应该查看一下MySQL的更新历史，看看是哪个版本的MySQL实现了这个语法。如果是这样，你就可以选择升级到新版的MySQL。
    
  + 一些常见问题的解决方法，参看[附录C 问题与常见错误][a5]。
[a5]:../Appendix_C/C.05.00_Problems_and_Common_Errors.md

  + 可以在[http://bugs.mysql.com/](http://bugs.mysql.com)搜索Bugs，查看Bug是否有人提交或是修复。
  
  + 可以在[http://lists.mysql.com/](http://lists.mysql.com/)搜索MySQL邮件列表的存档，参看[1.6.1 MySQL邮件列表][1.6.1]。
[1.6.1]:../Chapter_01/01.06.01_MySQL_Mailing_Lists.md

  +  你可以在[http://www.mysql.com/search/](http://www.mysql.com/search)来搜索所有MySQL网站的页面(包括手册)。
  
    如果在手册中或是在Bug库，邮件列表存档中都找不到答案，可以问问当地的MySQL专家。如果还是不能找到答案，可以参看如下的方式提交Bug。
    
    通常提交Bug需要访问[http://bugs.mysql.com/](http://bugs.mysql.com)，这是我们的Bug库地址。这个数据库是公共的，每个人都可以访问和搜索，如果登录了，就可以在系统中提交新的报告。
    
    在[http://bugs.mysql.com/](http://bugs.mysql.com)数据库中提交的Bug记录如果在某个发行版本中被修正，会在发布日志中列出。
    
    如果你在MySQL服务器中发现了敏感的安全问题，请立即发送邮件至<secalert_us@oracle.com>来通知我们。例外：支持用户需要报告所有问题，包括安全问题，发往[http://support.oracle.com/](http://support.oracle.com/)的Oracle支持网站。
    
    想要与用户讨论问题，可以使用MySQL的某个邮件列表。参看[1.6.1 MySQL邮件列表][1.6.1]。
[1.6.1]:../Chapter_01/01.06.00_MySQL_Information_Sources.md

    写一份好的Bug报告很需要耐心，但是第一次发现就立即报告会节约我们和你的时间。好的Bug报告，应当包括Bug的完整测试用例，以便我们在下个发布版本中尽量修复此Bug。本节便是为了帮你正确撰写Bug报告，以便你花费了时间却对我们帮助甚微甚至毫无帮助。请仔细阅读本节，确保本节提到的所有描述信息在你的报告中都有所包含。
    
    在提交之前，你最好能使用MySQL的最新发布版本或是开发版测试一下问题。任何人通过你的测试用例输入mysql test <script_file>，或是通过在你Bug报告中包含的Shell或者Perl脚本都应该能够复现这个Bug。任何我们能够复现的Bug都有较大机会在下个发布版本中修复。
    
    在Bug报告中包含了良好的问题描述信息对我们会非常有帮助。也就是说，给出一个良好的包含所有导致问题原因的例子及描述，并且问题本身细节描述准确。最好的报告就是包含完整的示例能够展示出如何产生Bug或是问题。参看[MySQL内部：转向其他操作系统](http://dev.mysql.com/doc/refman/5.6/en/porting.html)。
    
    记住，我们能够回复一个包含超多信息的报告，然而包含很少信息的就很难。人们经常忽略一些事实，因为他们认为他们知道问题的原因，并且觉得有些细节并不重要。需要遵循的良好原则是，如果不确定要不要添加描述，那么就添上。在你的报告上多写上几行能够使问题解决更快问题更少，因而不用等的很久或是还需要我们询问你来提供一些报告上缺少的信息。
    
    Bug报告中最常见的问题有，(a)没有描述你所使用的MySQL版本号，(b)没有详细描述MySQL服务器所安装的系统(包括系统种类及其版本号)。这些都是非常关键的信息，但是在100份报告中有99份都缺少这些信息。我们经常会收到这样的问题，“为什么这个在我这儿不好使”？结果我们发现他所说的功能在他用的MySQL版本中并没有提供，或是报告的Bug已经在较新的版本中修复了。问题通常也都与系统有关系。所以说，不知道系统类型及其版本号，我们也很难修复问题。
    
    如果你是用源码编译的MySQL，如果问题与这个有关系的话也别忘了提供编译器的信息。通常人们发现编译器的Bug都觉得跟MySQL有关系。大部分的编译器都在不断开发中，并且随着版本变化越来越好。你的问题是不是跟编译器有关系，我们只有知道了编译器的种类才能判断。注意所有的编译问题都应该报告为Bug并依照提交Bug的方式来提交。

    如果程序产生了一些错误信息，则在你的报告中带着错误信息就显得非常重要。如果我们想从存档中搜索相关信息，最好你报告中的错误信息与程序产生的信息是完全一致的(字母的大小写也应当注意)。最好是直接复制完整的错误信息并粘贴到你的报告中。千万不要凭记忆来描述错误信息。
    
    如果你对Connector/ODBC(MyODBC)有问题，请尝试生成追踪文件并与报告一同发送过来。参看[22.1.8.2 如何报告Connector/ODBC问题或Bug][22.1.8]。
[22.1.8]:../Chapter_22/22.01.08_ConnectorODBC_Support.md

    如果你的测试用例通过mysql命令行工具会输出很长的查询结果，你可以通过使用--vertical或是\G语句终止符来使输出更容易阅读。本节中后边的EXPLAIN SELECT示例展示了使用\G的效果。
    
    请在报告中包含如下内容：
    
    + 你所使用的MySQL发行版的版本号(例如MySQL 5.0.19)。你可以通过运行mysqladmin version来查看正在运行的mysql版本号。msyqladmin程序可以在MySQL安装文件夹下的bin文件夹中找到。
    
    + 你所遇到问题的机器的生产商及其型号。     
    
    + 操作系统的名字及其版本。如果你使用的是Windows系统，通常可以双击我的电脑图标，往下拉到“帮助/关于Windows”菜单来查看系统名称及其版本号。对于大部分Unin类操作系统，可以执行命令uname -a来获取这些信息。
    
    + 有时候大量内存的数据(虚拟与真实的内存)也有关系，如果不确定，就带上这些数据。
    
    + 如果你用的MySQL软件是源码编译的，要带上你编译时所使用编译器的名字与版本号。如果用的是二进制编译版本，带上发布的名字。
    
    + 如果问题是在编译期间发生的，需要包含确切的错误信息，同时也请带上几行文件中导致出错的代码。
    
    + 如果mysqld死掉，你的报告也要带上导致mysqld挂掉的语句。通常在启动mysqld时开启查询日志就可以记录这些信息，然后当mysqld崩溃时查看日志就能找到。参看[MySQL内部:移植到其他系统](http://dev.mysql.com/doc/refman/5.6/en/porting.html)。
    
    + 如果某个数据表与问题也有关系，在报告中需要包含SHOW CREATE TABLE db_name.tbl_name语句的输出结果。这是获取数据库中某个表的结构的非常简单的方式。语句输出的结果能使我们还原你所经历的情况。
    
    + 当产生问题时，SQL模式可能会对问题有很大影响，所以在报告中请附带上sql_mode系统变量的值。对于存储过程，存储程序以及触发对象，相关sql_mode的值会在创建对象时产生影响。对于存储程序与过程，SHOW CREATE PROCEDURE以及SHOW CREATE FUNCTION语句可以展示相关的SQL模式，或者你也可以通过查询INFORMATION_SCHEMA来获取这些信息：
	
	
	  ```sql
	  SELECT ROUTINE_SCHEMA,ROUTINE_NAME,SQL_MODE
	  FROM INFORMATION_SCHEMA.ROUTINES;
	  ```

      对于触发器，可以使用这个语句：
    
		```sql
		￼SELECT EVENT_OBJECT_SCHEMA, EVENT_OBJECT_TABLE,TRIGGER_NAME, SQL_MODE		FROM INFORMATION_SCHEMA.TRIGGERS; 
		```
		
    + 与SELECT语句性能相关的Bug或问题，你要记得带上EXPLAIN SELECT …,或者至少，SELECT语句结果包含的行数。然后记得带上相关表的SHOW CREATE TABLE tbl_name语句输出的结果。你能提供的关于你的情况的信息越多，别人就越有可能帮的上忙。
    
      如下是非常好的Bug报告范例。语句是通过mysql命令行工具运行的，记得使用\G语句分隔符，要不然会输出的行会变得非常长，读起来很困难。
      
      ```sql
		  ￼mysql> SHOW VARIABLES;  
		  mysql> SHOW COLUMNS FROM … \G   
		         <SHOW COLUMNS输出结果>  
		  mysql> EXPLAIN SELECT … \G  
		         <EXPLAIN输出结果>  
		  mysql> FLUSH STATUS;  
		  mysql> SELECT …;  
		         <SELECT结果的精简版,包括查询消耗的时间>  
		  mysql> SHOW STATUS;  
		         <SHOW STATUS的结果>
		  ```
		  
    + 如果当运行mysqld时产生了Bug或问题，最好尝试提供一个能重现问题的输入脚本。这个脚本要包含所有需要的源文件。这个脚本越能重现你的情况越好。如果你能写一个重现问题的单元测试，要把这个作为Bug报告的附件提交上来。
    
      如果你能提供一个脚本，那报告中至少要包含mysqladmin variables extended-status processlist的输出结果，来反应你系统执行情况的一些基本信息。
      
    + 如果你不能通过测试用例来生成几行结果，或是测试表太大(超过10行)不能包括在Bug报告中，那么你应该用mysqldump把数据表导出并创建一个README文件来描述你的问题。可用tar或是gzip或zip来压缩文件。当你在我们网站[http://bugs.mysql.com/](http://bugs.mysql.com/)的bug数据库中提交bug报告时，点击报告中的“文件”按钮来添加需要上传到bug数据库的文件。
    
    + 如果你觉得MySQL服务器在运行某条语句时的结果不正常，不要只包含结果，也要带上你认为正确的结果，以及你对结果的解释。
    
    + 如果你举了一个关于问题的例子，表名，变量名等等最好使用的是你在实际情况中用的，而不要自己新起个名字。问题可能与表名或是变量名有关系。这种情况很少见，也许，但是为了确保万一，还是带上吧。不管怎么说，举一个你在实际中使用的例子对你而言总归更容易一点，而且对我们而言也更好。如果你在Bug报告中的某些数据不想被别人看见，你可以在文件标签中选择“私有”这一项。如果信息是极度保密的，你也不希望被我们看到，那就举一个用其他内容代替的例子吧，但是仅把这作为最后的无奈之举吧。
    
    + 记得列出你所提供的程序的所有选项，如果可能的话。例如，写出你在开启mysqld服务器时带上的参数，同时带上你在使用MySQL客户端时的参数。对于mysqld或是mysql这些程序，或是配置脚本，参数通常都是解决问题的关键，非常有影响。写上这些参数永远都不是坏主意。如果你的问题出现在某种编程语言开发的程序比如Perl或是PHP中，请带上程序的解析器版本，同时带上所有程序用到的组件的名称及其版本号。例如，如果你的Perl脚本采用DBI和DBD::mysql模块，带上Perl，DBI，以及DBD::mysql的版本。
    
    + 如果你的问题与权限系统有关，请带上mysqlaccess的输出结果，mysqladmin reload的输出结果，以及当你试图连接到系统时所有的错误信息。当测试你的权限时，应该先运行一下mysqlaccess。之后，执行mysqladmin reload version并尝试使用你所遇到问题的程序去连接一下。mysqlaccess可以在MySQL安装文件夹下的bin文件夹中找到。
    
    + 如果你有一个针对Bug的补丁，也添加进来。但是不要假设这个补丁就是我们需要的，或是我们会用它，如果你不能提供一些必要信息诸如能够展示你的补丁所修复的Bug的测试用例。我们可能会在你的补丁中发现问题，甚至我们可能根本看不懂。如果是这样，我们也不会用它。
    
      如果我们不能验证补丁的确切目的，我们就不会用它。测试用例这时候能帮上忙。最好能展示出补丁所处理的所有可能发生的情况。如果我们找到一个补丁不管用的边界用例(甚至只是相似的一个)，那它可能就没用了。
      
    + 猜测Bug是什么，为什么会发生，或是它需要依赖什么，通常都是错的。甚至是MySQL团队都不会这样猜测，只有使用除错工具才能确定真正的原因。
    
    + 在Bug报告中说明你查找过相关手册以及邮件存档，这样别人就会知道你自己尝试过去解决问题。
    
    + 如果你的数据看起来不正常或是访问公共表的时候产生了问题，首先使用CHECK TABLE检查一下你的表。如果这个语句产生了任何错误：
    
      - InnoDB的崩溃恢复程序会自动清理，当服务器在被杀掉后重启时，所以通常并不需要“修复”数据表。如果你在使用InnoDB表时遇到错误，重启一下服务器看看问题还存在否，或只是内存中的缓存数据才会有影响。如果磁盘中的数据有损坏，考虑采用innodb_force_recovery选项重启一下这样可以导出受影响的表。
      
      - 对于非事务的表，可以用REPAIR TABLE或者myisamchk来尝试修复。参看[第五章 MySQL服务器管理][5.0]。
[5.0]:../Chapter_05/05.00.00_MySQL_Server_Administration.md  
        
        如果你用的是windows，用SHOW VARIABLES LIKE 'lower_case_table_names'语句检查一下lower_case_table_names的值。这个变量会影响到服务器如何处理数据库与表名字的字母大小写问题。它的值及其影响可以在[9.2.2标识大小写敏感性][9.2.2]找到。
[9.2.2]:../Chapter_09/09.02.02_Identifier_Case_Sensitivity.md

      - 如果你经常遇到表损坏，应该试着找出何时以及为何会发生这种情况。此时，MySQL数据文件夹内的错误日志可能会包含一些发生了什么情况的信息(这个文件名的后缀为.err)。参看[5.2.2错误日志][5.2.2]。在Bug报告中请将这个文件中的任何可能相关的信息附带上。通常mysqld从不会损坏一个表，如果没有它在更新过程中没有被杀掉。如果你能找到mysqld被结束的原因，对我们而言提供修复问题的方法就轻松了很多。参看[附录5.1如何找到产生问题的原因][c.5.1]。
[5.2.2]:../Chapter_05/05.02.02_The_Error_Log.md
[c.5.1]:../Appendix_C/C.05.01_How_to_Determine_What_Is_Causing_a_Problem.md

      - 如果可能，下载并安装最新版本的MySQL，看看能不能解决你的问题。所有版本的MySQL都经过完整测试并且运行起来没有问题。我们相信所有版本都尽可能向后兼容，使得你在更换MySQL版本时没有困难。参看[2.1.2选择MySQL的版本并安装][2.1.2]。
[2.1.2]:../Chapter_02/02.01.02_Choosing_Which_MySQL_Distribution_to_Install.md

    
    
      
		    
    
		
		
		
		
		
    
    
    
    
    
    
    
    