# The_InnoDB_Storage_Engine

#Table of Contents
14.1 Introduction to InnoDB ..................................................................................................... 1773|

14.1.1 Benefits of Using InnoDB Tables ........................................................................... 1774

14.1.2 Best Practices for InnoDB Tables .......................................................................... 1775

14.1.3 Checking InnoDB Availability ................................................................................. 1776

14.1.4 Testing and Benchmarking with InnoDB ................................................................. 1776

14.1.5 Turning Off InnoDB ............................................................................................... 1777

14.2 InnoDB and the ACID Model ............................................................................................ 1777

14.3 InnoDB Multi-Versioning ................................................................................................... 1779

14.4 InnoDB Architecture ......................................................................................................... 1780

14.4.1 Buffer Pool ........................................................................................................... 1780

14.4.2 Change Buffer ...................................................................................................... 1780

14.4.3 Adaptive Hash Index ............................................................................................. 1782

14.4.4 Redo Log Buffer ................................................................................................... 1783

14.4.5 System Tablespace .............................................................................................. 1783

14.4.6 InnoDB Data Dictionary ......................................................................................... 1783

14.4.7 Doublewrite Buffer ................................................................................................ 1783

14.4.8 Undo Logs ........................................................................................................... 1784

14.4.9 File-Per-Table Tablespaces ................................................................................... 1784

14.4.10 Undo Tablespace ................................................................................................ 1784

14.4.11 Redo Log ........................................................................................................... 1784

14.5 InnoDB Locking and Transaction Model ............................................................................ 1785

14.5.1 InnoDB Locking .................................................................................................... 1785

14.5.2 InnoDB Transaction Model .................................................................................... 1789

14.5.3 Locks Set by Different SQL Statements in InnoDB ................................................. 1796

14.5.4 Phantom Rows ..................................................................................................... 1799

14.5.5 Deadlocks in InnoDB ............................................................................................ 1800

14.6 InnoDB Configuration ....................................................................................................... 1803

14.6.1 InnoDB Startup Configuration ................................................................................ 1803

14.6.2 Configuring InnoDB for Read-Only Operation ......................................................... 1808

14.6.3 InnoDB Buffer Pool Configuration .......................................................................... 1809

14.6.4 Configuring the Memory Allocator for InnoDB ......................................................... 1821

14.6.5 Configuring InnoDB Change Buffering ................................................................... 1822

14.6.6 Configuring Thread Concurrency for InnoDB .......................................................... 1823

14.6.7 Configuring the Number of Background InnoDB I/O Threads ................................... 1825

14.6.8 Configuring the InnoDB Master Thread I/O Rate .................................................... 1825

14.6.9 Configuring Spin Lock Polling ................................................................................ 1826

14.6.10 Configuring InnoDB Purge Scheduling ................................................................. 1826

14.6.11 Configuring Optimizer Statistics for InnoDB .......................................................... 1826

14.6.12 Configuring the Merge Threshold for Index Pages ................................................ 1837

14.7 InnoDB Tablespaces ....................................................................................................... 1839

14.7.1 Resizing the InnoDB System Tablespace ............................................................... 1839

14.7.2 Changing the Number or Size of InnoDB Redo Log Files ........................................ 1841

14.7.3 Using Raw Disk Partitions for the System Tablespace ............................................ 1841

14.7.4 InnoDB File-Per-Table Tablespaces ....................................................................... 1843

14.7.5 Creating a File-Per-Table Tablespace Outside the Data Directory ............................ 1845

14.7.6 Copying File-Per-Table Tablespaces to Another Server .......................................... 1846

14.7.7 Storing InnoDB Undo Logs in Separate Tablespaces .............................................. 1850

14.8 InnoDB Tables and Indexes ............................................................................................. 1851

14.8.1 Creating InnoDB Tables ........................................................................................ 1851

14.8.2 Role of the .frm File for InnoDB Tables .................................................................. 1853

14.8.3 Physical Row Structure of InnoDB Tables .............................................................. 1853

14.8.4 Moving or Copying InnoDB Tables to Another Machine ........................................... 1855

14.8.5 Converting Tables from MyISAM to InnoDB ........................................................... 1857

14.8.6 AUTO_INCREMENT Handling in InnoDB ............................................................... 1862

14.8.7 InnoDB and FOREIGN KEY Constraints ................................................................ 1868

14.8.8 Limits on InnoDB Tables ....................................................................................... 1869

14.8.9 Clustered and Secondary Indexes ......................................................................... 1873

14.8.10 InnoDB FULLTEXT Indexes ................................................................................ 1873

14.8.11 Physical Structure of an InnoDB Index ................................................................. 1878

14.9 InnoDB Table Compression ............................................................................................. 1878

14.9.1 Overview of Table Compression ............................................................................ 1879

14.9.2 Enabling Compression for a Table ......................................................................... 1879

14.9.3 Tuning Compression for InnoDB Tables ................................................................. 1880

14.9.4 Monitoring Compression at Runtime ...................................................................... 1884

14.9.5 How Compression Works for InnoDB Tables .......................................................... 1885

14.9.6 Compression for OLTP Workloads ......................................................................... 1888

14.9.7 SQL Compression Syntax Warnings and Errors ..................................................... 1888

14.10 InnoDB File-Format Management ................................................................................... 1890

14.10.1 Enabling File Formats ......................................................................................... 1891

14.10.2 Verifying File Format Compatibility ....................................................................... 1891

14.10.3 Identifying the File Format in Use ........................................................................ 1894

14.10.4 Modifying the File Format .................................................................................... 1895

14.11 InnoDB Row Storage and Row Formats ......................................................................... 1895

14.11.1 Overview of InnoDB Row Storage ....................................................................... 1895

14.11.2 Specifying the Row Format for a Table ................................................................ 1896

14.11.3 DYNAMIC and COMPRESSED Row Formats ...................................................... 1896

14.11.4 COMPACT and REDUNDANT Row Formats ........................................................ 1896

14.12 InnoDB Disk I/O and File Space Management ................................................................ 1897

14.12.1 InnoDB Disk I/O .................................................................................................. 1897

14.12.2 File Space Management ..................................................................................... 1898

14.12.3 InnoDB Checkpoints ........................................................................................... 1899

14.12.4 Defragmenting a Table ........................................................................................ 1899

14.12.5 Reclaiming Disk Space with TRUNCATE TABLE .................................................. 1900

14.13 InnoDB and Online DDL ................................................................................................ 1900

14.13.1 Overview of Online DDL ...................................................................................... 1901

14.13.2 Performance and Concurrency Considerations for Online DDL .............................. 1906

14.13.3 SQL Syntax for Online DDL ................................................................................ 1909

14.13.4 Combining or Separating DDL Statements ........................................................... 1909

14.13.5 Examples of Online DDL ..................................................................................... 1910

14.13.6 Implementation Details of Online DDL .................................................................. 1931

14.13.7 How Crash Recovery Works with Online DDL ...................................................... 1932

14.13.8 Online DDL for Partitioned InnoDB Tables ........................................................... 1933

14.13.9 Limitations of Online DDL .................................................................................... 1933

14.14 InnoDB Startup Options and System Variables ............................................................... 1935

14.15 InnoDB INFORMATION_SCHEMA Tables ...................................................................... 2013

14.15.1 InnoDB INFORMATION_SCHEMA Tables about Compression .............................. 2014

14.15.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Information ................ 2015

14.15.3 InnoDB INFORMATION_SCHEMA System Tables ............................................... 2021

14.15.4 InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables ................................. 2026

14.15.5 InnoDB INFORMATION_SCHEMA Buffer Pool Tables .......................................... 2029

14.15.6 InnoDB INFORMATION_SCHEMA Metrics Table ................................................. 2033

14.16 InnoDB Integration with MySQL Performance Schema .................................................... 2041

14.16.1 Monitoring InnoDB Mutex Waits Using Performance Schema ................................ 2042

14.17 InnoDB Monitors ............................................................................................................ 2046

14.17.1 InnoDB Monitor Types ........................................................................................ 2046

14.17.2 Enabling InnoDB Monitors ................................................................................... 2047

14.17.3 InnoDB Standard Monitor and Lock Monitor Output .............................................. 2049

14.17.4 InnoDB Tablespace Monitor Output ..................................................................... 2054

14.17.5 InnoDB Table Monitor Output .............................................................................. 2056

14.18 InnoDB Backup and Recovery ....................................................................................... 2059

14.18.1 The InnoDB Recovery Process ............................................................................ 2060

14.19 InnoDB and MySQL Replication ..................................................................................... 2061

14.20 InnoDB memcached Plugin ............................................................................................ 2063

14.20.1 Benefits of the InnoDB memcached Plugin ........................................................... 2063

14.20.2 InnoDB memcached Architecture ......................................................................... 2064

14.20.3 Setting Up the InnoDB memcached Plugin ........................................................... 2068

14.20.4 Security Considerations for the InnoDB memcached Plugin ................................... 2073

14.20.5 Writing Applications for the InnoDB memcached Plugin ......................................... 2075

14.20.6 The InnoDB memcached Plugin and Replication .................................................. 2087

14.20.7 InnoDB memcached Plugin Internals ................................................................... 2090

14.20.8 Troubleshooting the InnoDB memcached Plugin ................................................... 2095

14.21 InnoDB Troubleshooting ................................................................................................. 2097

14.21.1 Troubleshooting InnoDB I/O Problems ................................................................. 2098

14.21.2 Forcing InnoDB Recovery ................................................................................... 2098

14.21.3 Troubleshooting InnoDB Data Dictionary Operations ............................................. 2100

14.21.4 InnoDB Error Handling ........................................................................................ 210
