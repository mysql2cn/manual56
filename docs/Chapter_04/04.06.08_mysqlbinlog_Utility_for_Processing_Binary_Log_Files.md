### 4.6.8. mysqlbinlog — 处理二进制日志文件的工具

服务器的二进制日志文件以“事件(events)”的形式记录了对数据库内容进行变更的操作。服务器以二进制格式记录该日志文件。如果想以文本格式查看日志文件的内容 则使用 [mysqlbinlog](#) 程序。也可以使用 [mysqlbinlog](#) 来查看主从复制时从服务器的延迟日志(relay log)文件，因为它与二进制日志文件是相同的格式。更多关于二进制日志和延迟日志的内容，详见[5.2.4 二进制日志][05.02.04] 和 [16.2.2 主从复制延迟和状态日志][16.02.02]。

[mysqlbinlog](#) 调用如下：

```shell
shell> mysqlbinlog [options] log_file ...
```

例如，如显示二进制日志文件binlog.000003的内容，则使用如下命令：

```shell
shell> mysqlbinlog binlog.0000003
```

输出的内容为 binlog.000003 中包含的事件。对于基于语句 (statement-based) 的日志， 事件信息包括SQL语句、服务器的ID、SQL语句开始执行的时间，执行消耗的时间等等；对于基于行 (row-based) 的日志，事件信息记录的是行的变更而不是SQL语句。更多关于日志模式的信息，详见 [16.1.2 主从复制格式][16.01.02] 。

在事件信息前是头注释，提供一些额外的信息。例如：

```shell
# at 141
#100309  9:28:36 server id 123  end_log_pos 245
  Query thread_id=3350  exec_time=11  error_code=0
```

第一行，at 后面的数字表明在二进制日志文件中事件的起始位置。

第二行，以日前和时间开头，表明在形成该事件的服务器上，事件开始执行的时间，在主从复制中，该时间戳被传递给从服务器；`server id` 是形成该事件的服务器的`server_id`；`end_log_pos` 表明下一个事件的起始位置(也就是当前事件的结束位置+1)；`thread_id` 表明哪个线程执行了该事件；`exec_time` 在主服务器上，它表示执行该事件所消耗的时间，在从服务器上，它表示该事件在从服务器上执行结束时间减去在主服务器上该事件开始执行时间的时间差，这个时间差可以作为从服务器落后主服务器多长时间的一个指示器；`error_code` 表明执行该事件的结果，0意味着没有错误发生。

[mysqlbinlog](#) 的输出可以被重新执行(例如，把输出作为 [mysql][04.05.01] 的输入)，重新执行日志文件中的语句。当服务器crash时，对恢复操作非常有用，有关实际使用的例子，参见本节接下来的介绍，也可参见[7.5 ”使用二进制日志进行实时增量修复“][07.05.00]。

通常情况下，使用 [mysqlbinlog](#) 来直接读取二进制日志文件并应用到本地MySQL服务器，也可以通过指定选项 --read-from-remote-server 来读取远程服务器的二进制日志文件。如果想读取远程服务器的二进制日志文件，需要指明连接到远程服务器所需要的连接参数，包括 --host, --password, --port, --protocol, --socket, 和 --user，如果没有指定选项 --read-from-remote-server，则这些选项是忽略不计的。

[mysqlbinlog](#) 支持的选项如表格所示，既可以在命令行中指定也可以在配置文件 [mysqlbinlog] 和 [client] 选项组中指定，[mysqlbinlog](#) 也支持影响配置文件处理的选项，详见 [4.2.3.4 “影响配置文件处理的命令行选项”][04.02.03.04]

Table 4.14. **mysqlbinlog** Options

<table summary="mysqlbinlog Options" border="0">
    <thead>
        <tr>
            <th scope="col">
                Format
            </th>
            <th scope="col">
                Option File
            </th>
            <th scope="col">
                Description
            </th>
            <th scope="col">
                Introduced
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td scope="row"><a href="javascript:void(0)">--base64-output=value</a></td>
            <td>
                <a href="javascript:void(0)">base64-output</a>
            </td>
            <td>
                Print binary log entries using base-64 encoding
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--bind-address=ip_address</a>
            </td>
            <td>
                <a href="javascript:void(0)">bind-address</a>
            </td>
            <td>
                Use the specified network interface to connect to the MySQL Server
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--binlog-row-event-max-size=#</a>
            </td>
            <td>
                <a href="javascript:void(0)">binlog-row-event-max-size</a>
            </td>
            <td>
                Binary log max event size
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--character-sets-dir=path</a>
            </td>
            <td>
                <a href="javascript:void(0)">character-sets-dir</a>
            </td>
            <td>
                The directory where character sets are installed
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--database=db_name</a>
            </td>
            <td>
                <a href="javascript:void(0)">database</a>
            </td>
            <td>
                List entries for just this database
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--debug[=debug_options]</a>
            </td>
            <td>
                <a href="javascript:void(0)">debug</a>
            </td>
            <td>
                Write a debugging log
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--debug-check</a>
            </td>
            <td>
                <a href="javascript:void(0)">debug-check</a>
            </td>
            <td>
                Print debugging information when the program exits
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--debug-info</a>
            </td>
            <td>
                <a href="javascript:void(0)">debug-info</a>
            </td>
            <td>
                Print debugging information, memory and CPU statistics when the program
                exits
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--default-auth=plugin</a>
            </td>
            <td>
                <a href="javascript:void(0)">default-auth=plugin</a>
            </td>
            <td>
                The authentication plugin to use
            </td>
            <td>
                5.6.2
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--disable-log-bin</a>
            </td>
            <td>
                <a href="javascript:void(0)">disable-log-bin</a>
            </td>
            <td>
                Disable binary logging
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--exclude-gtids=gtid_set</a>
            </td>
            <td>
                <a href="javascript:void(0)">exclude-gtids</a>
            </td>
            <td>
                Do not show any of the groups in the GTID set provided
            </td>
            <td>
                5.6.5
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--force-if-open</a>
            </td>
            <td>
                <a href="javascript:void(0)">force-if-open</a>
            </td>
            <td>
                Read binary log files even if open or not closed properly
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--force-read</a>
            </td>
            <td>
                <a href="javascript:void(0)">force-read</a>
            </td>
            <td>
                If mysqlbinlog reads a binary log event that it does not recognize, it
                prints a warning
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--help</a>
            </td>
            <td>
                &nbsp;
            </td>
            <td>
                Display help message and exit
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--hexdump</a>
            </td>
            <td>
                <a href="javascript:void(0)">hexdump</a>
            </td>
            <td>
                Display a hex dump of the log in comments
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--host=host_name</a>
            </td>
            <td>
                <a href="javascript:void(0)">host</a>
            </td>
            <td>
                Connect to the MySQL server on the given host
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--idempotent</a>
            </td>
            <td>
                <a href="javascript:void(0)">idempotent</a>
            </td>
            <td>
                Cause the server to use idempotent mode while processing binary log updates
                from this session only
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--include-gtids=gtid_set</a>
            </td>
            <td>
                <a href="javascript:void(0)">include-gtids</a>
            </td>
            <td>
                Show only the groups in the GTID set provided
            </td>
            <td>
                5.6.5
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--local-load=path</a>
            </td>
            <td>
                <a href="javascript:void(0)">local-load</a>
            </td>
            <td>
                Prepare local temporary files for LOAD DATA INFILE in the specified directory
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--login-path=name</a>
            </td>
            <td>
                &nbsp;
            </td>
            <td>
                Read login path options from .mylogin.cnf
            </td>
            <td>
                5.6.6
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--offset=#</a>
            </td>
            <td>
                <a href="javascript:void(0)">offset</a>
            </td>
            <td>
                Skip the first N entries in the log
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--password[=password]</a>
            </td>
            <td>
                <a href="javascript:void(0)">password</a>
            </td>
            <td>
                The password to use when connecting to the server
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--plugin-dir=path</a>
            </td>
            <td>
                <a href="javascript:void(0)">plugin-dir=path</a>
            </td>
            <td>
                The directory where plugins are located
            </td>
            <td>
                5.6.2
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--port=port_num</a>
            </td>
            <td>
                <a href="javascript:void(0)">port</a>
            </td>
            <td>
                The TCP/IP port number to use for the connection
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--protocol=type</a>
            </td>
            <td>
                <a href="javascript:void(0)">protocol</a>
            </td>
            <td>
                The connection protocol to use
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--raw</a>
            </td>
            <td>
                <a href="javascript:void(0)">raw</a>
            </td>
            <td>
                Write events in raw (binary) format to output files
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--read-from-remote-master=type</a>
            </td>
            <td>
                <a href="javascript:void(0)">read-from-remote-master</a>
            </td>
            <td>
                Read the binary log from a MySQL master rather than reading a local log
                file
            </td>
            <td>
                5.6.5
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--read-from-remote-server</a>
            </td>
            <td>
                <a href="javascript:void(0)">
                    read-from-remote-server
                </a>
            </td>
            <td>
                Read binary log from MySQL server rather than local log file
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--result-file=name</a>
            </td>
            <td>
                <a href="javascript:void(0)">result-file</a>
            </td>
            <td>
                Direct output to the given file
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">
                    --server-id=id
                </a>
            </td>
            <td>
                <a href="javascript:void(0)">
                    server-id
                </a>
            </td>
            <td>
                Extract only those events created by the server having the given server
                ID
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--set-charset=charset_name</a>
            </td>
            <td>
                <a href="javascript:void(0)">set-charset</a>
            </td>
            <td>
                Add a SET NAMES charset_name statement to the output
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--short-form</a>
            </td>
            <td>
                <a href="javascript:void(0)">short-form</a>
            </td>
            <td>
                Display only the statements contained in the log
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--skip-gtids[=true|false]</a>
            </td>
            <td>
                <a href="javascript:void(0)">skip-gtids</a>
            </td>
            <td>
                Do not show any GTIDs; not recommended in production
            </td>
            <td>
                5.6.5
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--socket=path</a>
            </td>
            <td>
                <a href="javascript:void(0)">
                    socket
                </a>
            </td>
            <td>
                For connections to localhost
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--start-datetime=datetime
                </a>
            </td>
            <td>
                <a href="javascript:void(0)">
                    start-datetime
                </a>
            </td>
            <td>
                Read binary log from first event with timestamp equal to or later than
                datetime argument
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--start-position=#
                </a>
            </td>
            <td>
                <a href="javascript:void(0)">start-position</a>
            </td>
            <td>
                Read binary log from first event with position equal to or greater than
                argument
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--stop-datetime=datetime</a>
            </td>
            <td>
                <a href="javascript:void(0)">stop-datetime</a>
            </td>
            <td>
                Stop reading binary log at first event with timestamp equal to or greater
                than datetime argument
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--stop-never</a>
            </td>
            <td>
                <a href="javascript:void(0)">stop-never</a>
            </td>
            <td>
                Stay connected to server after reading last binary log file
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--stop-never-slave-server-id=#</a>
            </td>
            <td>
                <a href="javascript:void(0)">stop-never-slave-server-id</a>
            </td>
            <td>
                Slave server ID to report when connecting to server
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--stop-position=#</a>
            </td>
            <td>
                <a href="javascript:void(0)">stop-position</a>
            </td>
            <td>
                Stop reading binary log at first event with position equal to or greater
                than argument
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">
                    --to-last-log
                </a>
            </td>
            <td>
                <a href="javascript:void(0)">to-last-log</a>
            </td>
            <td>
                Do not stop at the end of requested binary log from a MySQL server, but
                rather continue printing to end of last binary log
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">--user=user_name</a>
            </td>
            <td>
                <a href="javascript:void(0)">user</a>
            </td>
            <td>
                MySQL user name to use when connecting to server
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">
                    --verbose
                </a>
            </td>
            <td>
                &nbsp;
            </td>
            <td>
                Reconstruct row events as SQL statements
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">
                    --verify-binlog-checksum
                </a>
            </td>
            <td>
                &nbsp;
            </td>
            <td>
                Verify checksums in binary log
            </td>
            <td>
                5.6.1
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">
                    --version
                </a>
            </td>
            <td>
                &nbsp;
            </td>
            <td>
                Display version information and exit
            </td>
            <td>
                &nbsp;
            </td>
        </tr>
    </tbody>
</table>

* --help, -?

	显示帮助信息并退出

* --base64-output= *value*

	该选项用来决定何时将事件的 base-64 编码字符串使用 [BINLOG][13.07.06.01] 语句显示出来。该选项的可选值如下（大小写不敏感)：

	- AUTO("automatic") 或者 UNSPEC("unspecified"): 在需要的时候(即，对于格式描述事件和行事件)自动显示 [BINLOG][13.07.06.01] 语句，如果没有指定 --base64-output 选项，则默认的行为是 --base64-output=AUTO。
	
	> 注意：
	> 如果打算使用 [mysqlbinlog](#) 的输出来重新执行二进制日志文件的内容，则自动显示 [BINLOG][13.07.06.01] 语句是唯一安全的行为，其它的值仅仅用于调试或者测试，因为他们产生的输出可能不以可执行的形式包含所有事件。
	
	- NEVER : 从不显示 [BINLOG][13.07.06.01] 语句，如果一个行事件必须使用 [BINLOG][13.07.06.01] 来显示，则 [mysqlbinlog](#) 以一个错误信息退出
	- DECODE-ROWS ： 告知 [mysqlbinlog](#) 将行事件解密，如果同时指定了 --verbose 选项，则显示注释的SQL语句。像 NEVER 一样，DECODE-ROWS 不显示 [BINLOG][13.07.06.01] 语句，但是和 NEVER 不一样的是，如果遇到行事件的话，则不以错误信息退出。

	有关选项 --base64-output 和 --verbose 对行事件输出的影响的例子，详见 [4.6.8.2 “mysqlbinlog 行事件输出”](#4.6.8.2)。

* --bind-address= *ip_address*

	在有多个网卡的计算机上，该选项用来指定使用哪个网卡连接到MySQL服务器

	该选项从MySQL5.6.1开始支持的

* --binlog-row-event-max-size= *N*

	<table border="0">
    <tbody>
        <tr>
            <td scope="row">
                <span class="bold">
                    <strong>
                        Command-Line Format
                    </strong>
                </span>
            </td>
            <td colspan="3">
                <code class="literal">
                    --binlog-row-event-max-size=#
                </code>
            </td>
        </tr>
        <tr>
            <td scope="row">
                <span class="bold">
                    <strong>
                        Option-File Format
                    </strong>
                </span>
            </td>
            <td colspan="3">
                <code class="literal">
                    binlog-row-event-max-size
                </code>
            </td>
        </tr>
        <tr>
            <td scope="row" rowspan="5">
                &nbsp;
            </td>
            <td colspan="3">
                <span class="bold">
                    <strong>
                        Permitted Values
                    </strong>
                </span>
            </td>
        </tr>
        <tr>
            <td scope="row">
                <span class="bold">
                    <strong>
                        Platform Bit Size
                    </strong>
                </span>
            </td>
            <td colspan="2">
                <code class="literal">
                    64
                </code>
            </td>
        </tr>
        <tr>
            <td scope="row">
                <span class="bold">
                    <strong>
                        Type
                    </strong>
                </span>
            </td>
            <td colspan="2">
                <code class="literal">
                    numeric
                </code>
            </td>
        </tr>
        <tr>
            <td scope="row">
                <span class="bold">
                    <strong>
                        Default
                    </strong>
                </span>
            </td>
            <td colspan="2">
                <code class="literal">
                    4294967040
                </code>
            </td>
        </tr>
        <tr>
            <td scope="row">
                <span class="bold">
                    <strong>
                        Range
                    </strong>
                </span>
            </td>
            <td colspan="2">
                <code class="literal">
                    256 .. 18446744073709547520
                </code>
            </td>
        </tr>
    	</tbody>
	</table>

	指定了基于行 (row-based) 的二进制日志 事件的最大容量，按字节计算。行被分组成事件，因此尽量比该值小，该值应该是256的倍数，默认是4GB

* --character-sets-dir= *path*

	字符集安装的目录，详见 [10.5 “字符集设置”][10.05.00]

* --database= *db_name*, -d *db_name*

	该选项使 [mysqlbinglong](#) 输出使用 [USE][13.08.04] 选定的数据库 *db_name* 里的二进制日志（仅本地日志）条目。

	选项 --database 对于 [mysqlbinlog](#) 来讲类似于 --binlog-do-db 对于 [mysqld][04.03.01]，但是仅可以指定一个数据库，如果选项 --database 指定多次，仅使用最后一次。

	该选项的作用取决于日志的模式是基于语句的(statement-based) 还是基于行的(row-based),同样，选项--binlog-do-db 的作用也取决于日志的模式是基于语句的(statement-based) 还是基于行的(row-based)。

	**Statement-based logging**， 则--database 选项的作用如下：

	- 如果 *db\_name* 是默认的数据库，则无论是更改数据库 *db\_name* 中的表或其它数据库中表的语句都将输出。
	- 除非 *db\_name* 被选成为默认的数据库，语句才会输出，否则即使更改了数据库 *db\_name* 中表，语句也不输出。
	-  对于语句 [CREATE DATABASE][13.01.10]， [ALTER DATABASE][13.01.01] 和 [DROP DATABASE][13.01.21] 会抛出异常。当决定是否输出语句的时候，被 *created* , *altered* , 或者是 *dropped* 的数据库被认为是默认的数据库。

	假设日志模式是基于语句(statement-based)的，通过执行如下语句生成二进制日志文件：

	```sql
	INSERT INTO test.t1 (i) VALUES(100);
	INSERT INTO db2.t2 (j)  VALUES(200);
	USE test;
	INSERT INTO test.t1 (i) VALUES(101);
	INSERT INTO t1 (i)      VALUES(102);
	INSERT INTO db2.t2 (j)  VALUES(201);
	USE db2;
	INSERT INTO test.t1 (i) VALUES(103);
	INSERT INTO db2.t2 (j)  VALUES(202);
	INSERT INTO t2 (j)      VALUES(203);
	```

	[mysqlbinlog --database=test](#) 不输出前2个 [INSERT][13.02.05] 语句，因为没有默认的数据库，它输出 [USE test][13.08.04] 后的3个 [INSERT][13.02.05] 语句， 但不输出 [USE db2][13.08.04] 后的3个 [INSERT][13.02.05] 语句。

	[mysqlbinlog --database=db2](#) 不输出前2个 [INSERT][13.02.05] 语句，因为没有默认的数据库，也不输出 [USE test][13.08.04] 后的3个[INSERT][13.02.05] 语句，但是输出 [USE db2][13.08.04] 后的3个 [INSERT][13.02.05] 语句。


	**Row-based logging** ： [mysqlbinlog](#) 仅输出数据库 *db_name* 中表变更的条目，默认的数据库在此模式下无效。假如上面的这个二进制日志模式是基于行(row-based)的而不是基于语句(statement-based)的，则 [mysqlbinlog --database=test](#) 仅输出在数据库 test 里表 t1 的表更条目，不考虑 [USE][13.08.04] 指定的数据库或者默认的数据库。


	如果服务器的 binlog_format 设置成 MIXED并且你想指定选项 --database 来使用 [mysqlbinlog](#) ，你需要确保被变更的表是 [USE][13.08.04] 选定的数据库里的表(特别是，没有跨数据库的表的更新)。

	在 MySQL 5.6.10 以前，--database 选项对于 GTID-enabled 的 MySQL 服务器 的二进制日志文件来讲是无效的

* --debug[= *debug_options*], -# [ *debug_options*]

	写debug日志，典型的 *debug_options* 字符串是 'd:t:o,file_name' ， 默认的是 'd:t:o,/tmp/mysqlbinlog.trace'

* --debug-check

	程序退出的时候输出一些调试信息

* --debug-info

	程序退出的时候，输出调试信息及内存和CPU消耗的统计信息

* --default-auth=plugin

	客户端所用的验证插件，详见 [6.3.7 “插件式验证”][06.03.07]

	该选项是MySQL 5.6.2增加的

* --disable-log-bin, -D

	disable 二进制日志。如果指定了 --to-last-log 选项并且将输出发送到同一台服务器上，则使用该选项可以避免无限循环。当服务器crash后进行数据恢复的时候，使用该选项可以避免重复执行日志里的语句

	该选项需要你有 SUPER 的权限，它使 [mysqlbinlong](#) 在输出时包含 `SET sql_log_bin = 0` 语句以使后来的输出disable 二进制日志。除非有SUPER的权限，否则 [SET][13.07.04] 语句是无效的

* --exclude-gtids=gtid_set

	不输出在 *gtid_set* 中列出来的任何组，MySQL 5.6.6增加的

* --force-if-open, -F

	读取二进制日志文件即使他们已经被打开了或者没有正常关闭

* --force-read, -f

	当 [mysqlbinlog](#) 读取了不能识别的二进制日志事件时，如果指定了该选项，则输出警告信息，忽略该事件然后继续执行；如果没有指定该选项，则 [mysqlbinlog](#) 结束执行

* --hexdump, -H

	以十六进制输出日志内容，详见[4.6.8.1 “**mysqlbinlong** 十六进制输出”](#4.6.8.1)，十六进制的输出对于主从复制的调试非常有用

* --host= *host/_name*, -h *host/_name*

	获取指定主机上MySQL服务器的二进制日志文件

* --include-gtids=gtid_set
	
	仅显示 *gtid_set* 中列出来的组，MySQL 5.6.5增加

* --local-load= *path*, -l *path*

	在指定的目录里，给 [LOAD DATA INFILE][13.02.06] 操作准备本地临时文件

	> 重要
	> 这些临时文件不能被 [mysqlbinlong](#) 或者其它 MySQL程序自动删除

* --offset= *N*, -o *N*

	跳过日志里的前N个条目

* --password[= *password*], -p[ *password*]

	连接MySQL服务器时所用的密码。如果使用短格式(-p)，则在选项和密码直接不能有空格；如果在 --password 或者 -p 后面没有指定密码值，则 [mysqlbinlog](#) 提示输入密码值

	在命令行中指定密码应该被认为是不安全的，详见[6.1.2.1 “终端用户密码安全指南”][06.01.02.01]，可以使用配置文件来避免在命令行上指定密码

* --plugin-dir= *path*

	插件所在目录，如果使用了 --default-auth 选项指定了验证插件，但是 [mysqlbinlog](#) 没有找到它，则需要指定该选项

	MySQL 5.6.2增加的

* --port= *port\_num*, -P *port\_num*

	连接到远程服务器所用的TCP/IP端口号

* --protocol={TCP|SOCKET|PIPE|MEMORY}

	连接到远程服务器所用的协议，当其它的连接参数需要指定一个连接协议的时候该选项将非常有用，更多可选值，详见 [4.2.2 “连接到MySQL服务器”][04.02.02]

* --raw

	默认情况下，[mysqlbinlong](#) 读取二进制日志文件并以文本格式输出，选项 --raw 告诉 [mysqlbinlong](#) 以原来的二进制形式输出，使用该选项时需要指定 --read-from-remote-server 选项，因为日志文件是从远程服务器请求的；[mysqlbinlog] 对于在服务器上读取的每个文件创建一个输出文件；选项 --raw 可以用来备份二进制日志文件，如果同时指定 --stop-never 选项，则备份操作一直存在因为 [mysqlbinlong](#) 一直保持与MySQL服务器的连接；默认情况下，备份文件与原来的文件同名并输出到当前目录下，通过选项 --result-file 可以更改输出文件的文件名，更多信息，参见[4.6.8.3 “使用 **mysqlbinlong** 备份二进制日志文件”](#4.6.8.3)

	该选项是 MySQL 5.6.0增加的

* --read-from-remote-master= *type*

	将选项的值设置成 BINLOG-DUMP-NON-GTIDS 或者 BINLOG-DUMP-GTIDS，则相应的使用 COM_BINLOG_DUMP 或者 COM_BINLOG_DUMP_GTID 命令读取 MySQL 服务器二进制日志文件，如果 --read-from-remote-master=BINLOG-DUMP-GTIDS 和 --exclude-gtids 结合使用，主服务器上的事务信息被过滤掉，避免不必要的网络负担

	该选择是 MySQL 5.6.5增加的

* --read-from-remote-server, -R

	读取远程服务器的日志文件而不是读取本地的，如果没有指定该选项，则其它的相关选项被忽略，这些选项包括 --host, --password, --port, --protocol, --socket, 和 --user 

	该选项要求远程的服务器正在运行，它只用于程服务器的二进制日志文件，不包括延迟日志文件

	从MySQL 5.6.5 起，该选项类似于 --read-from-remote-master=BINLOG-DUMP-NON-GTIDS

* --result-file= *name*, -r *name*

	如果没有指定选项 --raw，该选项指明 [mysqlbinlong](#) 的输出文件；如果指定选项 --raw，[mysqlbinlog](#)对于每一个来自服务器的二进制文件在当前目录下输出一个与原文件同名的文件，此种情况下，选项 --result-file 的值被认为是一个输出文件名的前缀

* --server-id=id

	只显示由指定 Server ID 的服务器创建的事件

* --server-id-bits= *N*

	仅使用 --server-id 的前 *N* 位来标识服务器，如果二进制日志文件是由 server-id-bits 小于32的 [mysqld][04.03.01] 的服务器生成的并且用户数据存储在非常重要的位上，则将选项 -server-id-bits 的值设置为32可以看见这些数据

	该选项只在有MySQL Cluster功能的版本上支持，或者是从 MySQL Cluster sources 源码编译的

* --set-charset= *charset_name*

	在输出中增加 `SET NAMES charset_name` 语句指明处理日志文件所用的字符集

* --short-form, -s

	仅显示日志中的语句，不显示其他信息或者基于行(row-based)的事件。该选项仅仅为了测试，在生成环境中不应该使用该选项

* --skip-gtids[=(true|false)]

	不显示任何的 GTIDs，在生成环境中不推荐， MySQL 5.6.5增加的

* --socket=path, -S path

	对于localhost连接，指定所用的 Unix Socket file，或者Windows环境下，指定所使用的命名管道的名字

* --start-datetime= *datetime*

	从事件的时间戳等于或大于 *datetime* 处开始读取日志文件，*datetime* 是相对于运行 [mysqlbinlong](#) 程序所在主机的时间，该值的格式必须是数据类型 [DATETIME][11.03.01] 或者 [TIMESTAMP][11.03.01] 可识别的格式，例如：

	```shell
	shell> mysqlbinlog --start-datetime="2005-12-25 11:25:56" binlog.000003
	```

	该选项对于时点恢复(point-in-time recovery) 非常有用，详见[7.3 “备份和恢复策略的例子”][07.03.00]

* --start-position= *N*, -j *N*

	从事件的起始位置等于或者大于 *N* 处开始读取日志文件，该选项应用于命令行中指定的第一个日志文件

	该选项对于时点恢复(point-in-time recovery) 非常有用，详见[7.3 “备份和恢复策略的例子”][07.03.00]

* --stop-datetime= *datetime*

	在事件的时间戳等于或大于 *datetime* 处停止读取日志文件内容
	
	该选项对于时点恢复(point-in-time recovery) 非常有用，详见[7.3 “备份和恢复策略的例子”][07.03.00]

* --stop-never

	该选项和 --read-from-remote-server 一起使用，它告诉 [mysqlbinlog](#) 保持和服务器的连接，否则在最后一个文件传输完毕后 [mysqlbinlong](#) 程序退出。--stop-never 意味着 -to-last-log ，因此只需要在命令行中指定第一个日志文件的名字

	--stop-never 通常和 --raw 一起使用来做实时的二进制日志备份，也可以不和 --raw 一起使用来持续以文本形式显示二进制文件内容

	该选项是 MySQL5.6.0 增加的

* --stop-never-slave-server-id= *id*

	 当指定选项 --stop-never 时，[mysqlbinlog](#) 连接到MySQL服务器时所用的默认服务器ID是 65535， 使用选项 --stop-never-slave-server-id 可以显式的指明所用的 Server id，这样可以避免与其它从服务器 Server id或者其它 [mysqlbinlong](#) 进程相冲突，详见[4.6.8.4 “指定mysqlbinlong Server ID”](#4.6.8.4)

	MySQL 5.6.0增加

* --stop-position=N

	在事件的起始位置等于或者大于 *N* 处停止读取日志，该选项应用于命令行中指定的最后一个日志文件

* --to-last-log, -t

	当到达请求的二进制日志文件的末尾后也不停止输出，而是继续输出直到最后一个日志文件结束。如果将输出发送到同一台MySQL服务器上，这将导致死循环，该选项需要指定 --read-from-remote-server

* --user= *user/_name*, -u *user/_name*

	连接到远程MySQL服务器所用的用户名

* --verbose, -v

	重构行事件并以注释的SQL语句形式显示出来，如果指定该选项2次，则输出包括对数据类型和一些元数据的注释信息

	关于 --base64-output 和 --verbose 对于行事件输出影响的例子，详见[4.6.8.2 “mysqlbinlong 行事件输出”](#4.6.8.2)

* --verify-binlog-checksum, -c

	检测二进制文件的校验和，该选项是MySQL 5.6.1增加的

* --version, -V

	显示版本信息并退出

	在MySQL 5.6.1 之前，[mysqlbinlog](#) 版本号显示3.3，MySQL5.6.11之后，显示3.4(Bug #15894381, Bug #67643)


	可以使用 --var_name=value 语法来设置接下来的选项值

* open\_files\_limit

	指明打开的文件描述符的个数


可以使用管道来将 [mysqlbinlog](#) 输出到 [mysql][04.05.01]客户端来执行二进制日志文件中包含的事件。该技术用来做数据恢复当服务器crash的时候（详见[7.5 实时增量恢复使用二进制日志文件][07.05.00])，例如：

```shell
shell> mysqlbinlog binlog.000001 | mysql -u root -p
```
或者

```shell
shell> mysqlbinlog binlog.[0-9]* | mysql -u root -p
```

如果 [mysqlbinlong](#) 的输出包含 [BLOB][11.4.3] 类型的值，则当 [mysql][04.05.01] 客户端处理它们时候会出现问题，因此需要在调用 [mysql][04.05.01]时指定选项 --binary-mode 。

可以将 [mysqlbinlong](#) 的输出重定向到文本文件，如果需要更改日志中的语句(如删除由于某些原因不想执行的语句)，当编辑完日志文件之后，将它作为 [mysql][04.05.01] 的输入来执行这些语句：

```shell
shell> mysqlbinlog binlog.000001 > tmpfile
shell> ... edit tmpfile ...
shell> mysql -u root -p < tmpfile
```

[mysqlbinlong](#) 调用时如果指定了 --start-position 选项，则仅显示事件的偏移量大于或等于该值的事件(给定的位置必须匹配一个事件的起始位置)；它也有指定事件起始时间和结束时间的选项，使用 --stop-datetime 选项可以执行时点恢复操作(也就是说，比如，将数据库回滚到今天上午10:30)。
	

如果在 MySQL 服务器上有不止一个二进制日志需要执行，则安全的方式是使用一个到服务器连接来处理所有的文件，下面是一个可能不安全的例子：

```shell
shell> mysqlbinlog binlog.000001 | mysql -u root -p # DANGER!!
shell> mysqlbinlog binlog.000002 | mysql -u root -p # DANGER!!
```

像这种使用多个到服务器的连接来处理多个日志文件的方式可能会出现问题，如果第一个日志文件包含 [CREATE TEMPORARY TABLE][13.01.17] 语句并且第二个日志文件包含使用该临时文件的语句。当第一个 [mysql][04.05.01] 进程结束的时候，服务器删除了临时表，当第二个 [mysql][04.05.01] 进程尝试使用这个表的时候，服务器报告 “unknown table”。

为了避免这样的问题出现，使用一个 [mysql][04.05.01] 进程来处理所有你想处理的二进制日志文件，例子如下：

```shell
shell> mysqlbinlog binlog.000001 binlog.000002 | mysql -u root -p
```

另一种方法是将所有的日志写到一个文件里然后处理这个文件：

```shell
shell> mysqlbinlog binlog.000001 >  /tmp/statements.sql
shell> mysqlbinlog binlog.000002 >> /tmp/statements.sql
shell> mysql -u root -p -e "source /tmp/statements.sql"
```

[mysqlbinlog](#) 的输出中可能包含重新执行 [LOAD DATA INFILE][13.02.06] 的操作但是没有原来的数据文件。[mysqlbinlog](#) 将数据复制到一个临时文件里，然后输出一个指向该文件的 [LOAD DATA LOCAL INFILE][13.02.06] 语句，这些文件的默认的存储目录是系统指定的，如果想显式的指明该目录，则使用--local-load 选项。

因为 [mysqlbinlog] 将 [LOAD DATA INFILE][13.02.06] 语句转换成 [LOAD DATA LOCAL INFILE][13.02.06] 语句(也就是，加了local)，因此处理该语句的客户端和服务器都需要开启 LOCAL 功能，参见[6.1.6 “LOAD DATA LOCAL 的安全问题”][06.01.06]。

>警告 
>[LOAD DATA LOCAL][13.02.06] 语句所创建的临时文件并不会自动删除因为直到实际执行这些语句的时候他们都是需要的，你需要手动删除这些临时文件当不再需要这些日志的时候，这些文件可以在临时文件夹里找到，文件名类似 original\_file\_name-#-#。



#### [4.6.8.1. mysqlbinlog 十六进制格式输出](#4.6.8.1)

 选项 --hexdump 使 [mysqlbinlog](#) 以十六进制的形式输出二进制日志文件的内容：

```shell
shell> mysqlbinlog --hexdump master-bin.000001
```

十六进制的输出包括以 # 开头的注释行，因此上面这个命令的输出可能会像这样：

```sql
/*!40019 SET @@session.max_insert_delayed_threads=0*/;
/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
# at 4
#051024 17:24:13 server id 1  end_log_pos 98
# Position  Timestamp   Type   Master ID        Size      Master Pos    Flags
# 00000004 9d fc 5c 43   0f   01 00 00 00   5e 00 00 00   62 00 00 00   00 00
# 00000017 04 00 35 2e 30 2e 31 35  2d 64 65 62 75 67 2d 6c |..5.0.15.debug.l|
# 00000027 6f 67 00 00 00 00 00 00  00 00 00 00 00 00 00 00 |og..............|
# 00000037 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 |................|
# 00000047 00 00 00 00 9d fc 5c 43  13 38 0d 00 08 00 12 00 |.......C.8......|
# 00000057 04 04 04 04 12 00 00 4b  00 04 1a                |.......K...|
#       Start: binlog v 4, server v 5.0.15-debug-log created 051024 17:24:13
#       at startup
ROLLBACK;
```

十六进制的输出包含的元素内容如下面列表所示，格式有可能改变，更多关于二进制格式的内容，详见[MySQL Internals: The Binary Log](https://dev.mysql.com/doc/internals/en/binary-log.html)

* Position: 在日志文件中字节的位置(byte position)
* Timestamp: 事件时间戳，在本例中，'9d fc 5c 43' 是 '051024 17:24:13' 的十六进制表示形式
* Type: 事件类型码，在本例中，'0f' 表示 FORMAT\_DESCRIPTION\_EVENT，所有类型码列表如下：

	<table summary="This table lists event type codes" border="0">
    <thead>
        <tr>
            <th scope="col">
                Type
            </th>
            <th scope="col">
                Name
            </th>
            <th scope="col">
                Meaning
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td scope="row">
                <code class="literal">
                    00
                </code>
            </td>
            <td>
                <code class="literal">
                    UNKNOWN_EVENT
                </code>
            </td>
            <td>
                该事件永远不会在日志中出现
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    01
                </code>
            </td>
            <td>
                <code class="literal">
                    START_EVENT_V3
                </code>
            </td>
            <td>
                表明日志文件是由 MySQL 4 或 更早的版本写的.
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    02
                </code>
            </td>
            <td>
                <code class="literal">
                    QUERY_EVENT
                </code>
            </td>
            <td>
                最常见的事件类型，包含在主服务器上执行的语句
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    03
                </code>
            </td>
            <td>
                <code class="literal">
                    STOP_EVENT
                </code>
            </td>
            <td>
                表明主服务器已停止运行
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    04
                </code>
            </td>
            <td>
                <code class="literal">
                    ROTATE_EVENT
                </code>
            </td>
            <td>
                主服务器切换到一个新的日志文件，记录该事件
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    05
                </code>
            </td>
            <td>
                <code class="literal">
                    INTVAR_EVENT
                </code>
            </td>
            <td>
                用于<code>AUTO_INCREMENT</code>的值或者在语句中使用<code>LAST_INSERT_ID()</code>函数
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    06
                </code>
            </td>
            <td>
                <code class="literal">
                    LOAD_EVENT
                </code>
            </td>
            <td>
                在 MySQL 3.23， 用于 <code>LOAD DATA INFILE</code>语句
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    07
                </code>
            </td>
            <td>
                <code class="literal">
                    SLAVE_EVENT
                </code>
            </td>
            <td>
                保留以备将来使用
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    08
                </code>
            </td>
            <td>
                <code class="literal">
                    CREATE_FILE_EVENT
                </code>
            </td>
            <td>
                 用于 <code>LOAD DATA INFILE</code>语句，表明该语句开始执行，在从服务器上创建一个临时文件，仅在 MySQL4使用  
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    09
                </code>
            </td>
            <td>
                <code class="literal">
                    APPEND_BLOCK_EVENT
                </code>
            </td>
            <td>
                包含 <code>LOAD DATA INFILE<code> 语句用到的数据，数据保存在从服务器的临时文件里
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    0a
                </code>
            </td>
            <td>
                <code class="literal">
                    EXEC_LOAD_EVENT
                </code>
            </td>
            <td>
                用于 <code>LOAD DATA INFILE<code>语句，临时文件的内容保存在从服务器的表里，仅MySQL4使用
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    0b
                </code>
            </td>
            <td>
                <code class="literal">
                    DELETE_FILE_EVENT
                </code>
            </td>
            <td>
                回滚 <code>LOAD DATA INFILE</code> 语句，从服务器上的临时文件必须删除掉
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    0c
                </code>
            </td>
            <td>
                <code class="literal">
                    NEW_LOAD_EVENT
                </code>
            </td>
            <td>
                
                在 MySQL 4 及之前的版本中用于 LOAD DATA INFILE
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    0d
                </code>
            </td>
            <td>
                <code class="literal">
                    RAND_EVENT
                </code>
            </td>
            <td>
               如果在语句中用到了<code>RAND()</code>函数，则用于发送随即数的信息
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    0e
                </code>
            </td>
            <td>
                <code class="literal">
                    USER_VAR_EVENT
                </code>
            </td>
            <td>
                用于复制用户变量
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    0f
                </code>
            </td>
            <td>
                <code class="literal">
                    FORMAT_DESCRIPTION_EVENT
                </code>
            </td>
            <td>
                表明该日志文件是 MySQL 5 或之后的版本写的
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    10
                </code>
            </td>
            <td>
                <code class="literal">
                    XID_EVENT
                </code>
            </td>
            <td>
                表明一个 XA 事务的提交
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    11
                </code>
            </td>
            <td>
                <code class="literal">
                    BEGIN_LOAD_QUERY_EVENT
                </code>
            </td>
            <td>
                MySQL 5 或者以后的版本，用于<code>LOAD DATA INFILE</code>语句
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    12
                </code>
            </td>
            <td>
                <code class="literal">
                    EXECUTE_LOAD_QUERY_EVENT
                </code>
            </td>
            <td>
               MySQL 5 或者以后的版本，用于<code>LOAD DATA INFILE</code>语句
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    13
                </code>
            </td>
            <td>
                <code class="literal">
                    TABLE_MAP_EVENT
                </code>
            </td>
            <td>
                关于表定义的信息，用于 MySQL 5.1.5及以后
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    14
                </code>
            </td>
            <td>
                <code class="literal">
                    PRE_GA_WRITE_ROWS_EVENT
                </code>
            </td>
            <td>
                一个表应该创建的行数据，用于MySQL 5.1.5 到 5.1.17
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    15
                </code>
            </td>
            <td>
                <code class="literal">
                    PRE_GA_UPDATE_ROWS_EVENT
                </code>
            </td>
            <td>
                一个表需要更新的行数据，用于 MySQL 5.1.5 到 5.1.17
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    16
                </code>
            </td>
            <td>
                <code class="literal">
                    PRE_GA_DELETE_ROWS_EVENT
                </code>
            </td>
            <td>
                一个表应当删除的行数据，用于 MySQL 5.1.5 到 5.1.17
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    17
                </code>
            </td>
            <td>
                <code class="literal">
                    WRITE_ROWS_EVENT
                </code>
            </td>
            <td>
                一个表应当创建的行数据，用于 MySQL 5.1.18 及之后版本
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    18
                </code>
            </td>
            <td>
                <code class="literal">
                    UPDATE_ROWS_EVENT
                </code>
            </td>
            <td>
                一个表需要更新的行数据，用于MySQL 5.1.18 及之后版本
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    19
                </code>
            </td>
            <td>
                <code class="literal">
                    DELETE_ROWS_EVENT
                </code>
            </td>
            <td>
               一个表应该删除的行数据，用于 MySQL 5.1.18 及之后版本
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    1a
                </code>
            </td>
            <td>
                <code class="literal">
                    INCIDENT_EVENT
                </code>
            </td>
            <td>
                发生异常， MySQL 5.1.18 增加
            </td>
        </tr>
    </tbody>
	</table>
* Master ID: 创建该事件的主服务器的ID
* Size: 事件的大小，以字节计算
* Master Pos: 在原主服务器的日志文件里，下一个事件的位置
* Flags: 16 个flags。当前，只有如下列表里的flag在使用，其余的保留以备后用

	<table summary="This table lists flag " border="0">
    <thead>
        <tr>
            <th scope="col">
                Flag
            </th>
            <th scope="col">
                Name
            </th>
            <th scope="col">
                Meaning
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td scope="row">
                <code class="literal">
                    01
                </code>
            </td>
            <td>
                <code class="literal">
                    LOG_EVENT_BINLOG_IN_USE_F
                </code>
            </td>
            <td>
               日志文件正常关闭， (仅用于
                <code class="literal">
                    FORMAT_DESCRIPTION_EVENT
                </code>
                .) If this flag is set (if the flags are, for example,
                <code class="literal">
                    '01 00'
                </code>
                ) in a
                <code class="literal">
                    FORMAT_DESCRIPTION_EVENT
                </code>
                , the log file has not been properly closed. Most probably this is because
                of a master crash (for example, due to power failure).
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    02
                </code>
            </td>
            <td>
                &nbsp;
            </td>
            <td>
                保留以备后用
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    04
                </code>
            </td>
            <td>
                <code class="literal">
                    LOG_EVENT_THREAD_SPECIFIC_F
                </code>
            </td>
            <td>
                如果事件依赖于所执行的连接，比如，事件使用临时表，则设置该flag
            </td>
        </tr>
        <tr>
            <td scope="row">
                <code class="literal">
                    08
                </code>
            </td>
            <td>
                <code class="literal">
                    LOG_EVENT_SUPPRESS_USE_F
                </code>
            </td>
            <td>
                当事件不依赖于默认的数据库时，在某些情况下设置
            </td>
        </tr>
    </tbody>
	</table>



#### [4.6.8.2 mysqlbinlog 行事件输出](#4.6.8.2)

如下的例子证明了怎样使用 [mysqlbinlong](#) 来显示数据变更的行事件，这些事件对应的类型码是 WRITE_ROWS_EVENT, UPDATE_ROWS_EVENT, 和 DELETE_ROWS_EVEN，可能会使用选项 --base64-output=DECODE-ROWS 和 --verbose 来影响行事件的输出。

假设服务器的二进制日志模式是基于行(row-based)的，然后按顺序执行如下这些语句：

```sql
CREATE TABLE t
(
  id   INT NOT NULL,
  name VARCHAR(20) NOT NULL,
  date DATE NULL
) ENGINE = InnoDB;

START TRANSACTION;
INSERT INTO t VALUES(1, 'apple', NULL);
UPDATE t SET name = 'pear', date = '2009-01-01' WHERE id = 1;
DELETE FROM t WHERE id = 1;
COMMIT;
```

默认情况下，[mysqlbinlog](#) 使用 [BINLOG][13.07.06.01] 语句输出行事件的 base-64 编码字符串。忽略其余的行，上述语句的行事件的输出如下：

```shell
shell> mysqlbinlog log_file
...
# at 218
#080828 15:03:08 server id 1  end_log_pos 258   Write_rows: table id 17 flags: STMT_END_F

BINLOG '
fAS3SBMBAAAALAAAANoAAAAAABEAAAAAAAAABHRlc3QAAXQAAwMPCgIUAAQ=
fAS3SBcBAAAAKAAAAAIBAAAQABEAAAAAAAEAA//8AQAAAAVhcHBsZQ==
'/*!*/;
...
# at 302
#080828 15:03:08 server id 1  end_log_pos 356   Update_rows: table id 17 flags: STMT_END_F

BINLOG '
fAS3SBMBAAAALAAAAC4BAAAAABEAAAAAAAAABHRlc3QAAXQAAwMPCgIUAAQ=
fAS3SBgBAAAANgAAAGQBAAAQABEAAAAAAAEAA////AEAAAAFYXBwbGX4AQAAAARwZWFyIbIP
'/*!*/;
...
# at 400
#080828 15:03:08 server id 1  end_log_pos 442   Delete_rows: table id 17 flags: STMT_END_F

BINLOG '
fAS3SBMBAAAALAAAAJABAAAAABEAAAAAAAAABHRlc3QAAXQAAwMPCgIUAAQ=
fAS3SBkBAAAAKgAAALoBAAAQABEAAAAAAAEAA//4AQAAAARwZWFyIbIP
'/*!*/;
```

如果想以注释的形式查看行事件的“伪SQL”语句，则指定选项 --verbose 或者 -v来调用 [mysqlbinlog](#) ，输出将包含以 ### 开始的行：

```shell
shell> mysqlbinlog -v log_file
...
# at 218
#080828 15:03:08 server id 1  end_log_pos 258   Write_rows: table id 17 flags: STMT_END_F

BINLOG '
fAS3SBMBAAAALAAAANoAAAAAABEAAAAAAAAABHRlc3QAAXQAAwMPCgIUAAQ=
fAS3SBcBAAAAKAAAAAIBAAAQABEAAAAAAAEAA//8AQAAAAVhcHBsZQ==
'/*!*/;
### INSERT INTO test.t
### SET
###   @1=1
###   @2='apple'
###   @3=NULL
...
# at 302
#080828 15:03:08 server id 1  end_log_pos 356   Update_rows: table id 17 flags: STMT_END_F

BINLOG '
fAS3SBMBAAAALAAAAC4BAAAAABEAAAAAAAAABHRlc3QAAXQAAwMPCgIUAAQ=
fAS3SBgBAAAANgAAAGQBAAAQABEAAAAAAAEAA////AEAAAAFYXBwbGX4AQAAAARwZWFyIbIP
'/*!*/;
### UPDATE test.t
### WHERE
###   @1=1
###   @2='apple'
###   @3=NULL
### SET
###   @1=1
###   @2='pear'
###   @3='2009:01:01'
...
# at 400
#080828 15:03:08 server id 1  end_log_pos 442   Delete_rows: table id 17 flags: STMT_END_F

BINLOG '
fAS3SBMBAAAALAAAAJABAAAAABEAAAAAAAAABHRlc3QAAXQAAwMPCgIUAAQ=
fAS3SBkBAAAAKgAAALoBAAAQABEAAAAAAAEAA//4AQAAAARwZWFyIbIP
'/*!*/;
### DELETE FROM test.t
### WHERE
###   @1=1
###   @2='pear'
###   @3='2009:01:01'
```

指定 --verbose 或者 -v 2次，可以显示每列的数据类型和元数据信息，在每列的后面包含更多的注释信息：

```shell
shell> mysqlbinlog -vv log_file
...
# at 218
#080828 15:03:08 server id 1  end_log_pos 258   Write_rows: table id 17 flags: STMT_END_F

BINLOG '
fAS3SBMBAAAALAAAANoAAAAAABEAAAAAAAAABHRlc3QAAXQAAwMPCgIUAAQ=
fAS3SBcBAAAAKAAAAAIBAAAQABEAAAAAAAEAA//8AQAAAAVhcHBsZQ==
'/*!*/;
### INSERT INTO test.t
### SET
###   @1=1 /* INT meta=0 nullable=0 is_null=0 */
###   @2='apple' /* VARSTRING(20) meta=20 nullable=0 is_null=0 */
###   @3=NULL /* VARSTRING(20) meta=0 nullable=1 is_null=1 */
...
# at 302
#080828 15:03:08 server id 1  end_log_pos 356   Update_rows: table id 17 flags: STMT_END_F

BINLOG '
fAS3SBMBAAAALAAAAC4BAAAAABEAAAAAAAAABHRlc3QAAXQAAwMPCgIUAAQ=
fAS3SBgBAAAANgAAAGQBAAAQABEAAAAAAAEAA////AEAAAAFYXBwbGX4AQAAAARwZWFyIbIP
'/*!*/;
### UPDATE test.t
### WHERE
###   @1=1 /* INT meta=0 nullable=0 is_null=0 */
###   @2='apple' /* VARSTRING(20) meta=20 nullable=0 is_null=0 */
###   @3=NULL /* VARSTRING(20) meta=0 nullable=1 is_null=1 */
### SET
###   @1=1 /* INT meta=0 nullable=0 is_null=0 */
###   @2='pear' /* VARSTRING(20) meta=20 nullable=0 is_null=0 */
###   @3='2009:01:01' /* DATE meta=0 nullable=1 is_null=0 */
...
# at 400
#080828 15:03:08 server id 1  end_log_pos 442   Delete_rows: table id 17 flags: STMT_END_F

BINLOG '
fAS3SBMBAAAALAAAAJABAAAAABEAAAAAAAAABHRlc3QAAXQAAwMPCgIUAAQ=
fAS3SBkBAAAAKgAAALoBAAAQABEAAAAAAAEAA//4AQAAAARwZWFyIbIP
'/*!*/;
### DELETE FROM test.t
### WHERE
###   @1=1 /* INT meta=0 nullable=0 is_null=0 */
###   @2='pear' /* VARSTRING(20) meta=20 nullable=0 is_null=0 */
###   @3='2009:01:01' /* DATE meta=0 nullable=1 is_null=0 */
```

指定选项 --base64-output=DECODE-ROWS 可以使 [mysqlbinlog](#) 不输出行事件的 [BINLOG][13.07.06.01] 语句，有点类似于 --base64-output=NEVER ，但是如果发现行事件时候程序不会已错误信息退出。--base64-output=DECODE-ROWS 和 --verbose 结合使用可以方便的以SQL语句形式查看行事件：

```shell
shell> mysqlbinlog -v --base64-output=DECODE-ROWS log_file
...
# at 218
#080828 15:03:08 server id 1  end_log_pos 258   Write_rows: table id 17 flags: STMT_END_F
### INSERT INTO test.t
### SET
###   @1=1
###   @2='apple'
###   @3=NULL
...
# at 302
#080828 15:03:08 server id 1  end_log_pos 356   Update_rows: table id 17 flags: STMT_END_F
### UPDATE test.t
### WHERE
###   @1=1
###   @2='apple'
###   @3=NULL
### SET
###   @1=1
###   @2='pear'
###   @3='2009:01:01'
...
# at 400
#080828 15:03:08 server id 1  end_log_pos 442   Delete_rows: table id 17 flags: STMT_END_F
### DELETE FROM test.t
### WHERE
###   @1=1
###   @2='pear'
###   @3='2009:01:01'
```

>注意
>如果想重新执行[mysqlbinlog](#) 的输出则不能压制 [BINLOG][13.07.06.01] 语句的输出。

指定选项--verbose 产生的行事件SQL语句比相应的 [BINLOG][13.07.06.01] 语句更容易读，然而，它们不能准确的对应着形成该事件的原始SQL语句，有如下限制：

* 原来的列名称丢失了，代之以 @N ，N表示列的序列号
* 在二进制日志文件里，字符集的信息是不可用的，影响字符列的显示：

	- 二进制和非二进制字符串类型之间没有区别([BINARY][11.04.02] 、 [CHAR][11.04.01] 、[VARBINARY][11.04.02] [VARCHAR][11.04.01] [BLOB ][11.04.03] [TEXT][11.04.03])。对于固定长度的字符串输出 STRING 数据类型，对于可变长度的字符串输出 VARSTRING 数据类型
	- 对于多字节字符集，在二进制日志文件里不包含每个字符的最大字节数，因此字符串类型的长度是按字节计算而不是按字符，例如，STRING(4)将适用于如下2种类型值中任何一个：
	
	```shell
	CHAR(4) CHARACTER SET latin1
	CHAR(2) CHARACTER SET ucs2
	```

	- 由于事件类型 UPDATE_ROWS_EVENT 的存储模式问题，带有 WHERE 的[UPDATE][13.02.11] 语句在 SET 语句之前显示


对于行事件的正确解析需要来自二进制日志文件起始部分的模式描述事件的信息，因为 [mysqlbinlog](#) 提前不知道日志的其它部分是否包含行事件，因此默认情况下，在输出的起始部分使用 [BINLOG][13.07.06.01] 语句输出模式描述事件。

如果提前知道二进制日志文件中不包含任何需要 [BINLOG][13.07.06.01] 语句的事件(即，没有行事件)，则可以使用选项 --base64-output=NEVER 来阻止该信息头的输出。



#### [4.6.8.3. 使用 mysqlbinlog 备份二进制日志文件](#4.6.8.3)

默认情况下，[mysqlbinlog](#) 读取二进制日志文件并以文本格式输出文件内容，这样有利于检测和重新执行(例如将输出作为[mysql][04.05.01] 是输入)文件中的事件。[mysqlbinlog](#) 既可以读取本地文件系统的二进制日志文件，又可以通过指定选项 --read-from-remote-server 读取远程服务器的日志文件内容。[mysqlbinlog](#) 既可以输出到标准输出，又可以通过指定选项 --result-file=*file_name* 来输出到指定文件。

从MySQL5.6开始，[mysqlbinlog](#) 可以读取二进制日志文件并将相同的内容写到新的文件里 — 即以二进制格式而不是文本格式，这使直接备份二进制日志文件变得非常的容易。[mysqlbinlog](#) 可以做静态备份，备份一组日志文件，最后一个文件备份结束后停止；也可以做持续("live")备份，当备份完最后一个文件后仍然保持和服务器的连接，当有新事件生成的时候继续复制事件。在持续备份操作中，[mysqlbinlog] 一直运行直到连接中断(例如，当服务器退出)或者 [mysqlbinlog](#) 被强制结束。当服务器重启后如果想继续持续备份，则也需要重启 [mysqlbinlog](#)。

备份二进制日志需要在调用 [mysqlbinlog](#) 时至少指定2个选项：

* --read-from-remote-server (或者 -R) 选项告诉 [mysqlbinlog](#) 连接到一个服务器并且获取它的二进制日志文件（类似于主从复制中，从服务器连接到主服务器)
* --raw 选项告诉 [mysqlbinlog](#) 是 raw (二进制)输出，而不是纯文本格式

和 --read-from-remote-server 选项一起，通常需要指定其它的选项：--host指明运行服务器的主机，同时也需要指明其它连接选项如 --user 和　--password。

其它几个和 -raw 一起使用非常有用的选项如下：

* --stop-never: 当备份完最后一个日志文件后仍然保持和服务器的连接并继续读取新的事件
* --stop-never-slave-server-id=id: 当指定选项 --stop-never时， [mysqlbinlog](#) 向服务器报告的 Server ID ，默认的是65535，这可以避免和从服务器ID或者其它 [mysqlbinlog](#) 进程冲突，参见[4.6.8.4 “指定 mysqlbinlog 的 Server ID”](#4.6.8.4)
* --result-file:输出文件的文件名前缀

如果想使用 [mysqlbinlog](#) 来备份服务器的二进制日志文件，则必须指定服务器上实际存在的文件名，如果不知道文件名，则连接到服务器上然后使用 [SHOW BINARY LOGS][13.07.05.02] 命令来查看当前的文件名，假设该命令产生的结果如下：

```shell
mysql> SHOW BINARY LOGS;
+---------------+-----------+
| Log_name      | File_size |
+---------------+-----------+
| binlog.000130 |     27459 |
| binlog.000131 |     13719 |
| binlog.000132 |     43268 |
+---------------+-----------+
```

有了上述信息，则可以使用 [mysqlbinlog](#) 像如下这样备份二进制日志文件到当前的文件夹(每行输入一个命令)：

* 静态备份，从文件 binlog.000130 到文件 binlog.000132，可以使用如下2命令中任何一个：

  ```shell
  mysqlbinlog --read-from-remote-server --host=host_name --raw
    binlog.000130 binlog.000131 binlog.000132

  mysqlbinlog --read-from-remote-server --host=host_name --raw
    --to-last-log binlog.000130
  ```

  第一个命令显式的指明了每个文件名，第二个命令只指定了第一个文件名和选项--to-last-log来读取到最后一个文件。两个命令间的区别是： 如果服务器在 [mysqlbinlog](#) 读取到文件 binlog.000132 的末尾前恰好打开文件 binlog.000133 ，第一个命令将不读取，第二个命令将仍然读取。

* 持续备份，起始文件是 binlog.000130 ，复制已经存在的日志文件然后继续保持和服务器的连接，一旦服务器生成新事件则继续复制它们:

  ```shell
  mysqlbinlog --read-from-remote-server --host=host_name --raw
  --stop-never binlog.000130
  ```

  已经指定了选项 --stop-never，则不需要指定 --to-last-log 来读取到最后一个文件因为 --stop-never 已经蕴含那个意思了。

**命名输出文件**

如果没有指定选项 --raw 则 [mysqlbinlog](#) 产生纯文本输出，如果指定了选项 --result-file ，所有的输出都将写到该文件里；如果指定了选项 --raw，则 [mysqlbinlog](#) 将从服务器获取的每个日志文件单独输出到一个文件，默认情况下，文件保存在当前目录下，文件名与原文件名相同，如果想更改输出文件名，则使用 --result-file 选项。当选项 --result-file 和选项 --raw 一起使用时，选项的值被认为是输出文件名的前缀。

假设当前服务器的日志文件起始文件名是 binlog.000999 ，如果使用命令 `mysqlbinlog --raw` 来备份日志文件， 使用选项 --result-file 产生的输出将如下表所示。可以将选项 --result-file 的值以目录路径名开始，这样可以将文件写到指定的目录里；如果 --result-file 的值仅包含目录名，则该值必须以目录分隔符结尾；如果输出文件已经存在，则他们将被覆盖。

<table  border="0">
    <thead>
        <tr>
            <th scope="col">
                <a href="javascript:void(0)">
                     --result-file
                </a>
                Option
            </th>
            <th scope="col">
                Output File Names
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">
                    --result-file=x
                </a>
            </td>
            <td>
                <code>
                    xbinlog.000999
                </code>
                and up
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">
                    --result-file=/tmp/
                </a>
            </td>
            <td>
                <code>
                    /tmp/binlog.000999
                </code>
                and up
            </td>
        </tr>
        <tr>
            <td scope="row">
                <a href="javascript:void(0)">
                   
                        --result-file=/tmp/x
                   
                </a>
            </td>
            <td>
                <code>
                    /tmp/xbinlog.000999
                </code>
                and up
            </td>
        </tr>
    </tbody>
</table>


例子：使用 [mysqldump][04.05.04] + [mysqlbinlog](#) 完成备份和恢复

接下来的例子描述了一个简单的场景，介绍了怎样结合使用 [mysqldump][04.05.04] 和 [mysqlbinlog](#) 来备份数据和二进制日志，怎么恢复服务器如果数据丢失了。该例子假设服务器所在的主机是 *host_name*，第一个日志文件的文件名是 binlog.000999 。每个命令在一行输入：

使用 [mysqlbinlog](#) 持续备份二进制日志文件：

```shell
mysqlbinlog --read-from-remote-server --host=host_name --raw --stop-never binlog.000999
```

使用命令 [mysqldump][04.05.04] 创建服务器数据的快照文件(dump file)， 同时指定选项 --all-databases, --events, 和 --routines 来备份所有的数据，指定选项 --master-data=2 将在输出文件中包含当前二进制日志文件的坐标。

```shell
mysqldump --host=host_name --all-databases --events --routines --master-data=2> dump_file
```

周期性的执行 [mysqldump][04.05.04] 命令以创建新的快照文件。

如果数据丢失（服务器crash了），使用最近的dump文件来恢复数据：

```shell
mysql --host=host_name -u root -p < dump_file
```
然后查看dump文件里包含的二进制日志文件的坐标信息，重新执行该坐标之后的二进制日志文件中的事件。假设文件中的坐标看起来像这样：

```shell
-- CHANGE MASTER TO MASTER_LOG_FILE='binlog.001002', MASTER_LOG_POS=27284;
```

如果最近的备份文件名是 binlog.001004 ，则如下这样重新执行日志中事件：

```shell
mysqlbinlog --start-position=27284 binlog.001002 binlog.001003 binlog.001004
  | mysql --host=host_name -u root -p
```

你会发现很容易将备份文件(dump文件和日志文件)复制到服务器主机上,然后执行恢复操作，有可能MySQL不允许远程的 root 权限。

#### [4.6.8.4. 指定 mysqlbinlog Server ID](#4.6.8.4)

当指定选项 --read-from-remote-server 时，[mysqlbinlog](#) 连接到MySQL服务器上，指明一个Server ID来标识它自己，并且请求那个服务器的二进制日志文件。[mysqlbinlog](#) 可以使用多种方法来请求服务器日志文件：

* 显示指明文件名: 对于每个文件，[mysqlbinlog](#) 连接服务器并发出 `Binlog dump` 命令，服务器发送文件后关闭连接。每个文件都有一个连接。
* 指明起始文件和 --to-last-log 选项：[mysqlbinlog](#)连接服务器并对所有的文件发送一个 `Binlog dump` 命令，服务器发送所有的文件然后关闭连接。
* 指明起始文件和 --stop-never(即--to-last-log)选项：[mysqlbinlog](#)连接服务器并对所有的文件发送一个 `Binlog dump` 命令，服务器发送所有的文件，但是发送完最后一个文件后也不关闭连接。

如果仅指定 --read-from-remote-server 选项，[mysqlbinlog](#) 连接服务器时使用的Server ID 是0，告诉服务器当发送完最后一个日志文件后关闭连接。

如果同时指定 --read-from-remote-server 和 --stop-never，[mysqlbinlog](#) 连接服务器时使用一个非0的Server ID，告诉服务器在发送完最后一个日志文件后也不关闭连接，默认的Server ID是65535，但是可以通过选项 --stop-never-slave-server-id 来改变该值。

对于前两种请求文件的方式，因为 [mysqlbinlog](#) 指定了一个为0的Server ID，因此在发送完所有日志文件后关闭连接；如果指定了选项 --stop-never则发送完所有文件后也不关闭连接，因为指定了一个非0的Server ID。



[04.02.03.04]: ./04.02.03_Specifying_Program_Options.md#4.2.3.4
[04.03.01]:./04.03.01_mysqld_The_MySQL_Server.md
[04.05.01]:./04.05.01_mysql_The_MySQL_Command-Line_Tool.md
[04.05.04]:./04.05.04_mysqldump_A_Database_Backup_Program.md
[05.02.04]:../Chapter_05/05.02.04_The_Binary_Log.md
[06.01.02.01]:./Chapter_06/06.01.02_Keeping_Passwords_Secure.md#6.1.2.4
[06.01.06]:./Chapter_06/06.01.06_Security_Issues_with_LOAD_DATA_LOCAL.md
[07.03.00]:../Chapter_07/07.03.00_Example_Backup_and_Recovery_Strategy.md
[07.05.00]:../Chapter_07/07.05.00_Point-in-Time_Incremental_Recovery_Using_the_Binary_Log.md
[10.05.00]:../Chapter_10/10.05.00_Character_Set_Configuration.md
[11.03.01]:../Chapter_11/11.03.01_The_DATE_DATETIME_and_TIMESTAMP_Types.md
[11.04.01]:../Chapter_11/11.04.01_The_CHAR_and_VARCHAR_Types.md
[11.04.02]:../Chapter_11/11.04.02_The_BINARY_and_VARBINARY_Types.md
[11.04.03]:../Chapter_11/11.04.03_The_BLOB_and_TEXT_Types.md
[13.01.01]:../Chapter_13/13.01.01_ALTER_DATABASE_Syntax.md
[13.01.10]:../Chapter_13/13.01.10_CREATE_DATABASE_Syntax.md
[13.01.21]:../Chapter_13/13.01.21_DROP_DATABASE_Syntax.md
[13.02.11]:../Chapter_13/13.02.11_UPDATE_Syntax.md
[13.01.17]:../Chapter_13/13.01.17_CREATE_TABLE_Syntax.md
[13.02.05]:../Chapter_13/13.02.05_INSERT_Syntax.md
[13.02.06]:../Chapter_13/13.02.06_LOAD_DATA_INFILE_Syntax.md
[13.07.05.02]:./Chapter_13/13.07.05_SHOW_Syntax.md#13.7.5.2
[13.07.06.01]:../Chapter_13/13.07.06_Other_Administrative_Statements.md#13.7.6.1
[13.08.04]:../Chapter_13/13.08.04_USE_Syntax.md
[16.01.02]:../Chapter_16/16.01.02_Replication_Formats.md
[16.02.02]:../Chapter_16/16.02.02_Replication_Relay_and_Status_Logs.md
